<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0f">
    <title>Commander - Offline</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            color: #f0f0f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
        }

        .icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 16px;
        }

        p {
            color: #a0a0b0;
            margin-bottom: 24px;
            max-width: 320px;
            line-height: 1.5;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 280px;
        }

        button {
            padding: 16px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:active {
            opacity: 0.8;
        }

        .btn-primary {
            background: #00d4ff;
            color: #000;
        }

        .btn-secondary {
            background: #1a1a24;
            color: #f0f0f5;
        }

        .status {
            margin-top: 32px;
            padding: 16px;
            background: #12121a;
            border-radius: 8px;
            font-size: 14px;
            color: #606070;
            width: 100%;
            max-width: 320px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .status-item:last-child {
            margin-bottom: 0;
        }
    </style>
</head>

<body>
    <div class="icon">üì°</div>
    <h1>You're Offline</h1>
    <p>Commander couldn't load the requested page. Your data is safe in local storage.</p>

    <div class="actions">
        <button class="btn-primary" onclick="location.href='./'">
            üè† Go to Home
        </button>
        <button class="btn-secondary" onclick="location.reload()">
            üîÑ Try Again
        </button>
        <button class="btn-secondary" onclick="exportData()">
            üì¶ Export My Data
        </button>
    </div>

    <div class="status">
        <div class="status-item">
            <span>Connection:</span>
            <span id="connectionStatus">Checking...</span>
        </div>
        <div class="status-item">
            <span>Service Worker:</span>
            <span id="swStatus">Checking...</span>
        </div>
    </div>

    <script>
        // Check connection
        document.getElementById('connectionStatus').textContent =
            navigator.onLine ? 'üü¢ Online' : 'üî¥ Offline';

        // Check service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(reg => {
                document.getElementById('swStatus').textContent =
                    reg.active ? 'üü¢ Active' : 'üü° Waiting';
            }).catch(() => {
                document.getElementById('swStatus').textContent = 'üî¥ Error';
            });
        } else {
            document.getElementById('swStatus').textContent = '‚ö™ Not supported';
        }

        // Export data function
        async function exportData() {
            try {
                const request = indexedDB.open('commander-db', 3);
                request.onsuccess = () => {
                    const db = request.result;
                    const tx = db.transaction('documents', 'readonly');
                    const store = tx.objectStore('documents');
                    const getReq = store.get('main');

                    getReq.onsuccess = () => {
                        const data = getReq.result || { inbox: [], next: [], shipToday: [], logs: [] };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `commander-emergency-backup-${new Date().toISOString().split('T')[0]}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                    };
                };
                request.onerror = () => {
                    alert('Could not access database');
                };
            } catch (err) {
                alert('Export failed: ' + err.message);
            }
        }
    </script>
</body>

</html>