import"./style-eV2glYNL.js";const x="commander-db",y=3;function S(){return new Promise((e,o)=>{const t=indexedDB.open(x,y);t.onerror=()=>o(t.error),t.onsuccess=()=>e(t.result),t.onupgradeneeded=d=>{const a=d.target.result;a.objectStoreNames.contains("documents")||a.createObjectStore("documents",{keyPath:"id"}),a.objectStoreNames.contains("pending")||a.createObjectStore("pending",{keyPath:"id"})}})}const l=new URLSearchParams(window.location.search),m=e=>{const o=l.get(e);if(!o)return"";try{return decodeURIComponent(o.replace(/\+/g," "))}catch{return o}},p=m("title"),w=m("text"),h=m("url"),B=l.get("auto")==="true",b=l.get("source");let n="";p&&(n+=p+`

`);w&&(n+=w+`

`);h&&(n+=h);n=n.trim();function D(e){const o=document.createElement("div");return o.textContent=e,o.innerHTML}n||(n="(No content shared)");document.getElementById("sharedContent").textContent=n;function E(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}if(B&&n&&n!=="(No content shared)"){const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:bold;color:#00d4ff;background:#000;padding:20px;border-radius:12px;z-index:9999;border:2px solid #00d4ff;",e.textContent="ðŸ¤– Auto-Saving...",document.body.appendChild(e),setTimeout(()=>{window.save()},500)}window.cancel=function(){window.location.href="./index.html"};window.save=async function(){const e=document.getElementById("category").value,o=document.getElementById("saveAs").value.trim();let t=document.getElementById("tags").value.trim(),d=e,a="logs";b==="ai"&&(t&&(t+=", "),t+="#ai-suggestion",a="inbox");const v=t?t.split(",").map(c=>c.trim()).filter(Boolean):[],g={id:E(),createdAt:new Date().toISOString(),source:b||"share",route:a,category:d,saveAs:o,tags:v,content:D(n)};try{const f=(await S()).transaction("documents","readwrite").objectStore("documents");let s=await new Promise((i,u)=>{const r=f.get("main");r.onsuccess=()=>i(r.result),r.onerror=()=>u(r.error)});if(s||(s={id:"main",inbox:[],next:[],shipToday:[],logs:[],shipped:[],schemaVersion:3}),s.logs||(s.logs=[]),s.logs.slice(0,5).some(i=>i.content===g.content)){alert("This content was already saved recently.");return}s.logs.unshift(g),s.updatedAt=Date.now(),await new Promise((i,u)=>{const r=f.put(s);r.onsuccess=()=>i(),r.onerror=()=>u(r.error)}),document.getElementById("toast").classList.add("show"),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{window.location.href="./index.html"},1500)}catch(c){alert("Failed to save: "+c.message)}};
