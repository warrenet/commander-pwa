import"./style-BwNgLAiu.js";const A="commander-db",I=3;function P(){return new Promise((e,i)=>{const t=indexedDB.open(A,I);t.onerror=()=>i(t.error),t.onsuccess=()=>e(t.result),t.onupgradeneeded=d=>{const r=d.target.result;r.objectStoreNames.contains("documents")||r.createObjectStore("documents",{keyPath:"id"}),r.objectStoreNames.contains("pending")||r.createObjectStore("pending",{keyPath:"id"})}})}const l=new URLSearchParams(window.location.search),m=e=>{const i=l.get(e);if(!i)return"";try{return decodeURIComponent(i.replace(/\+/g," "))}catch{return i}},x=m("title"),y=m("text"),b=m("url"),B=l.get("auto")==="true",p=l.get("source"),v=l.get("priority"),h=m("category");let o="";x&&(o+=x+`

`);y&&(o+=y+`

`);b&&(o+=b);o=o.trim();function C(e){const i=document.createElement("div");return i.textContent=e,i.innerHTML}o||(o="(No content shared)");document.getElementById("sharedContent").textContent=o;function D(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}if(B&&o&&o!=="(No content shared)"){const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:bold;color:#00d4ff;background:#000;padding:20px;border-radius:12px;z-index:9999;border:2px solid #00d4ff;",e.textContent="ðŸ¤– Auto-Saving...",document.body.appendChild(e),setTimeout(()=>{window.save()},500)}window.cancel=function(){window.location.href="./index.html"};window.save=async function(){const e=document.getElementById("category").value,i=document.getElementById("saveAs").value.trim();let t=document.getElementById("tags").value.trim(),d=e,r="logs";p==="ai"&&(t&&(t+=", "),t+="#ai-suggestion",r="inbox"),v==="high"?(t&&(t+=", "),t+="#priority-high"):v==="medium"&&(t&&(t+=", "),t+="#priority-medium"),h&&(t&&(t+=", "),t+=`#${h}`,d=h);const S=t?t.split(",").map(u=>u.trim()).filter(Boolean):[],a={id:D(),createdAt:new Date().toISOString(),source:p||"share",route:r,category:d,saveAs:i,tags:S,content:C(o)};try{const w=(await P()).transaction("documents","readwrite").objectStore("documents");let n=await new Promise((c,f)=>{const s=w.get("main");s.onsuccess=()=>c(s.result),s.onerror=()=>f(s.error)});if(n||(n={id:"main",inbox:[],next:[],shipToday:[],logs:[],shipped:[],schemaVersion:3}),n.logs||(n.logs=[]),n.logs.slice(0,5).some(c=>c.content===a.content)){alert("This content was already saved recently.");return}n.logs.unshift(a),r==="inbox"&&(n.inbox||(n.inbox=[]),n.inbox.unshift({id:a.id,text:a.content,createdAt:a.createdAt})),n.updatedAt=Date.now(),await new Promise((c,f)=>{const s=w.put(n);s.onsuccess=()=>c(),s.onerror=()=>f(s.error)});const g=document.getElementById("toast");p==="ai"?g.textContent="ðŸ¤– AI Suggestion Saved!":g.textContent="Saved!",g.classList.add("show"),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{window.location.href="./index.html"},1500)}catch(u){alert("Failed to save: "+u.message)}};
