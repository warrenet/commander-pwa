import"./style-Co32Lo0v.js";const I="commander-db",B=3;function P(){return new Promise((e,n)=>{const t=indexedDB.open(I,B);t.onerror=()=>n(t.error),t.onsuccess=()=>e(t.result),t.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains("documents")||a.createObjectStore("documents",{keyPath:"id"}),a.objectStoreNames.contains("pending")||a.createObjectStore("pending",{keyPath:"id"})}})}const l=new URLSearchParams(window.location.search),m=e=>{const n=l.get(e);if(!n)return"";try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return n}},y=m("title"),w=m("text"),v=m("url"),D=l.get("auto")==="true",p=l.get("source"),S=l.get("priority"),h=m("category");let i="";y&&(i+=y+`

`);w&&(i+=w+`

`);v&&(i+=v);i=i.trim();function E(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}i||(i="(No content shared)");document.getElementById("sharedContent").textContent=i;function C(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}const x=l.get("batch");if(x)try{const e=JSON.parse(decodeURIComponent(x));if(Array.isArray(e)&&e.length>0){const n=document.createElement("div");n.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:bold;color:#00d4ff;background:#000;padding:20px;border-radius:12px;z-index:9999;border:2px solid #00d4ff;",n.textContent=`ðŸ¤– Bulk Importing ${e.length} items...`,document.body.appendChild(n);const t=e.map(o=>{const a={id:C(),text:typeof o=="string"?o:o.text||String(o),createdAt:Date.now(),tags:["#ai-batch"]};return itemsStore.add(a)});Promise.all(t).then(()=>{n.textContent=`âœ… ${e.length} items added to Inbox!`,setTimeout(()=>{window.location.href="./index.html"},1e3)}).catch(o=>{console.error("Bulk ingestion error:",o),n.textContent="âŒ Bulk import failed"})}}catch(e){console.error("Failed to parse batch param:",e)}if(!x&&D&&i&&i!=="(No content shared)"){const e=document.createElement("div");e.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:bold;color:#00d4ff;background:#000;padding:20px;border-radius:12px;z-index:9999;border:2px solid #00d4ff;",e.textContent="ðŸ¤– Auto-Saving...",document.body.appendChild(e),setTimeout(()=>{window.save()},500)}window.cancel=function(){window.location.href="./index.html"};window.save=async function(){const e=document.getElementById("category").value,n=document.getElementById("saveAs").value.trim();let t=document.getElementById("tags").value.trim(),o=e,a="logs";p==="ai"&&(t&&(t+=", "),t+="#ai-suggestion",a="inbox"),S==="high"?(t&&(t+=", "),t+="#priority-high"):S==="medium"&&(t&&(t+=", "),t+="#priority-medium"),h&&(t&&(t+=", "),t+=`#${h}`,o=h);const A=t?t.split(",").map(u=>u.trim()).filter(Boolean):[],c={id:C(),createdAt:new Date().toISOString(),source:p||"share",route:a,category:o,saveAs:n,tags:A,content:E(i)};try{const b=(await P()).transaction("documents","readwrite").objectStore("documents");let r=await new Promise((d,f)=>{const s=b.get("main");s.onsuccess=()=>d(s.result),s.onerror=()=>f(s.error)});if(r||(r={id:"main",inbox:[],next:[],shipToday:[],logs:[],shipped:[],schemaVersion:3}),r.logs||(r.logs=[]),r.logs.slice(0,5).some(d=>d.content===c.content)){alert("This content was already saved recently.");return}r.logs.unshift(c),a==="inbox"&&(r.inbox||(r.inbox=[]),r.inbox.unshift({id:c.id,text:c.content,createdAt:c.createdAt})),r.updatedAt=Date.now(),await new Promise((d,f)=>{const s=b.put(r);s.onsuccess=()=>d(),s.onerror=()=>f(s.error)});const g=document.getElementById("toast");p==="ai"?g.textContent="ðŸ¤– AI Suggestion Saved!":g.textContent="Saved!",g.classList.add("show"),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{window.location.href="./index.html"},1500)}catch(u){alert("Failed to save: "+u.message)}};
