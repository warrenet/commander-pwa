import"./style-CdRYQMGF.js";const ge=(e,t)=>t.some(n=>e instanceof n);let Oe,Me;function xt(){return Oe||(Oe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Et(){return Me||(Me=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fe=new WeakMap,le=new WeakMap,ae=new WeakMap;function kt(e){const t=new Promise((n,o)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{n(C(e.result)),a()},r=()=>{o(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",r)});return ae.set(t,e),t}function St(e){if(fe.has(e))return;const t=new Promise((n,o)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{n(),a()},r=()=>{o(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)});fe.set(e,t)}let he={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return fe.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return C(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Je(e){he=e(he)}function Lt(e){return Et().includes(e)?function(...t){return e.apply(ye(this),t),C(this.request)}:function(...t){return C(e.apply(ye(this),t))}}function Tt(e){return typeof e=="function"?Lt(e):(e instanceof IDBTransaction&&St(e),ge(e,xt())?new Proxy(e,he):e)}function C(e){if(e instanceof IDBRequest)return kt(e);if(le.has(e))return le.get(e);const t=Tt(e);return t!==e&&(le.set(e,t),ae.set(t,e)),t}const ye=e=>ae.get(e);function It(e,t,{blocked:n,upgrade:o,blocking:a,terminated:i}={}){const r=indexedDB.open(e,t),s=C(r);return o&&r.addEventListener("upgradeneeded",c=>{o(C(r.result),c.oldVersion,c.newVersion,C(r.transaction),c)}),n&&r.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),s.then(c=>{i&&c.addEventListener("close",()=>i()),a&&c.addEventListener("versionchange",d=>a(d.oldVersion,d.newVersion,d))}).catch(()=>{}),s}const Ct=["get","getKey","getAll","getAllKeys","count"],Bt=["put","add","delete","clear"],de=new Map;function $e(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(de.get(t))return de.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,a=Bt.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(a||Ct.includes(n)))return;const i=async function(r,...s){const c=this.transaction(r,a?"readwrite":"readonly");let d=c.store;return o&&(d=d.index(s.shift())),(await Promise.all([d[n](...s),a&&c.done]))[0]};return de.set(t,i),i}Je(e=>({...e,get:(t,n,o)=>$e(t,n)||e.get(t,n,o),has:(t,n)=>!!$e(t,n)||e.has(t,n)}));const Dt=["continue","continuePrimaryKey","advance"],Ne={},be=new WeakMap,Ke=new WeakMap,At={get(e,t){if(!Dt.includes(t))return e[t];let n=Ne[t];return n||(n=Ne[t]=function(...o){be.set(this,Ke.get(this)[t](...o))}),n}};async function*Ot(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,At);for(Ke.set(n,t),ae.set(n,ye(t));t;)yield n,t=await(be.get(n)||t.continue()),be.delete(n)}function Re(e,t){return t===Symbol.asyncIterator&&ge(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ge(e,[IDBIndex,IDBObjectStore])}Je(e=>({...e,get(t,n,o){return Re(t,n)?Ot:e.get(t,n,o)},has(t,n){return Re(t,n)||e.has(t,n)}}));const Ye="commander-db",Qe=3,j="documents",G="pending",Se=3;let R=null;async function q(){return R||(R=await It(Ye,Qe,{upgrade(e,t,n){console.log(`[DB] Upgrading from v${t} to v${n}`),e.objectStoreNames.contains(j)||e.createObjectStore(j,{keyPath:"id"}),e.objectStoreNames.contains(G)||e.createObjectStore(G,{keyPath:"id"})}}),await Mt(),R)}async function Mt(){const e=await R.get(j,"main");if(!e)return;let t=!1;const n={...e};n.schemaVersion||(console.log("[DB] Migrating: Adding schemaVersion"),n.schemaVersion=1,t=!0),n.schemaVersion<2&&(console.log("[DB] Migrating v1 â†’ v2: Ensuring logs array"),Array.isArray(n.logs)||(n.logs=[]),n.schemaVersion=2,t=!0),n.schemaVersion<3&&(console.log("[DB] Migrating v2 â†’ v3: Ensuring shipped array"),Array.isArray(n.shipped)||(n.shipped=[]),["inbox","next","shipToday"].forEach(o=>{Array.isArray(n[o])&&(n[o]=n[o].map((a,i)=>a.id?a:{...a,id:`migrated_${o}_${i}_${Date.now()}`}))}),n.schemaVersion=3,t=!0),t&&(console.log("[DB] Saving migrated document"),await z(n))}async function z(e){const n=(await q()).transaction(j,"readwrite");await n.store.put({id:"main",schemaVersion:Se,...e,updatedAt:Date.now()}),await n.done,await Nt()}async function Ze(){const e=await q(),t=await e.get(G,"main");return t?(console.log("[DB] Recovering from pending write"),await z(t),t):e.get(j,"main")}async function $t(e){const n=(await q()).transaction(G,"readwrite");await n.store.put({id:"main",...e,pendingAt:Date.now()}),await n.done}async function Nt(){const t=(await q()).transaction(G,"readwrite");await t.store.delete("main"),await t.done}function Le(){return{schemaVersion:Se,inbox:[],next:[],shipToday:[],logs:[],shipped:[]}}async function Xe(){var e,t,n,o,a;try{const i=await Ze();return{dbName:Ye,dbVersion:Qe,schemaVersion:(i==null?void 0:i.schemaVersion)||"unknown",itemCounts:{inbox:((e=i==null?void 0:i.inbox)==null?void 0:e.length)||0,next:((t=i==null?void 0:i.next)==null?void 0:t.length)||0,shipToday:((n=i==null?void 0:i.shipToday)==null?void 0:n.length)||0,logs:((o=i==null?void 0:i.logs)==null?void 0:o.length)||0,shipped:((a=i==null?void 0:i.shipped)==null?void 0:a.length)||0},lastUpdated:i!=null&&i.updatedAt?new Date(i.updatedAt).toISOString():"never"}}catch(i){return{error:i.message}}}const Rt=[{pattern:/\b(buy|get|pick up|grab|shop)\b/i,tag:"#errand"},{pattern:/\b(groceries|store|market)\b/i,tag:"#errand"},{pattern:/\b(fix|debug|code|deploy|refactor|test)\b/i,tag:"#dev"},{pattern:/\b(bug|error|crash|issue)\b/i,tag:"#dev"},{pattern:/\b(API|database|server|frontend|backend)\b/i,tag:"#dev"},{pattern:/\b(call|email|text|message|reach out|contact)\b/i,tag:"#comms"},{pattern:/\b(meet|meeting|sync|standup)\b/i,tag:"#comms"},{pattern:/\b(exercise|workout|gym|run|walk|yoga)\b/i,tag:"#health"},{pattern:/\b(doctor|dentist|appointment|medication)\b/i,tag:"#health"},{pattern:/\b(pay|bill|invoice|budget|expense|money)\b/i,tag:"#finance"},{pattern:/\b(bank|transfer|deposit)\b/i,tag:"#finance"},{pattern:/\b(read|learn|study|research|course)\b/i,tag:"#learn"},{pattern:/\b(book|article|tutorial|video)\b/i,tag:"#learn"},{pattern:/\b(clean|organize|laundry|dishes|vacuum)\b/i,tag:"#home"},{pattern:/\b(repair|fix|maintenance)\b/i,tag:"#home"},{pattern:/\b(report|presentation|proposal|deadline)\b/i,tag:"#work"},{pattern:/\b(client|project|task|review)\b/i,tag:"#work"},{pattern:/\b(urgent|asap|important|critical)\b/i,tag:"#priority"},{pattern:/\b(today|now|immediately)\b/i,tag:"#priority"},{pattern:/\b(waiting|blocked|pending|on hold)\b/i,tag:"#waiting"}];function Pt(e){if(!e||typeof e!="string")return[];const t=new Set;for(const n of Rt)n.pattern.test(e)&&t.add(n.tag);return Array.from(t)}let l=Le(),U=null,Y=null;const ve=new Set;let ie="idle",Te="tasks";const Ut=300;function ee(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}function v(){return l}function re(){return ie}function Q(){return Te}function b(e){Te=e,g()}function Wt(e){return ve.add(e),()=>ve.delete(e)}function g(){ve.forEach(e=>e(l,ie,Te))}function K(e){ie=e,g()}function k(){Y&&clearTimeout(Y),$t(l).catch(console.error),K("saving"),Y=setTimeout(async()=>{try{await z(l),K("saved"),setTimeout(()=>{ie==="saved"&&K("idle")},2e3)}catch(e){console.error("[State] Save failed:",e),K("error")}},Ut)}function w(){U=JSON.parse(JSON.stringify(l))}async function Pe(){try{const e=await Ze();e&&(l={inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[]}),g()}catch(e){console.error("[State] Failed to load:",e),l=Le(),g()}}function O(e,t="",n=[]){w();const o=Pt(t),a=[...new Set([...n,...o])],i={id:ee(),text:t,tags:a.length>0?a:void 0,createdAt:Date.now()};return l[e]=[...l[e],i],k(),g(),i.id}function we(e,t,n){l[e].findIndex(a=>a.id===t)!==-1&&(Y||w(),l[e]=l[e].map(a=>a.id===t?{...a,text:n}:a),k(),g())}function et(e,t){w(),l[e]=l[e].filter(n=>n.id!==t),k(),g()}function Ft(e,t,n){if(e===t)return;w();const o=l[e].find(a=>a.id===n);o&&(l[e]=l[e].filter(a=>a.id!==n),l[t]=[...l[t],o],k(),g())}function Vt(){w(),l=Le(),k(),g()}function jt(){if(!U)return!1;const e=l;return l=U,U=e,k(),g(),!0}function Gt(){return U!==null}async function Ht(e){w(),l={inbox:Array.isArray(e.inbox)?e.inbox:[],next:Array.isArray(e.next)?e.next:[],shipToday:Array.isArray(e.shipToday)?e.shipToday:[],logs:Array.isArray(e.logs)?e.logs:[]},await z(l),g()}function Ie(e,t="manual",n="logs",o=[]){w();const a=e.trim();if(l.logs.length>0){const r=l.logs[0];if(r.content===a)return console.log("[State] Duplicate log ignored"),r.id}const i={id:ee(),createdAt:new Date().toISOString(),source:t,route:n,tags:o,content:a};if(l.logs=[i,...l.logs],n==="inbox"||n==="next"||n==="shipToday"){const r={id:ee(),text:e.trim()};l[n]=[...l[n],r]}return k(),g(),i.id}function _t(e){w(),l.logs=l.logs.filter(t=>t.id!==e),k(),g()}function qt(){return l.logs||[]}function zt(e){if(!e||!e.trim())return l.logs||[];const t=e.toLowerCase().trim();return(l.logs||[]).filter(n=>n.content.toLowerCase().includes(t)||n.tags.some(o=>o.toLowerCase().includes(t)))}function Jt(e,t,n,o){var r;if(!n||!n.trim())throw new Error("Save As is required");if(!o||!o.trim())throw new Error("Definition of Done is required");w();const a=(r=l[e])==null?void 0:r.find(s=>s.id===t);if(!a)return null;const i={id:ee(),originalId:t,text:a.text,saveAs:n.trim(),definitionOfDone:o.trim(),shippedAt:new Date().toISOString(),fromSection:e,logLine:`${new Date().toLocaleTimeString()} | SHIPPED: ${n.trim()} â€” DoD: ${o.trim()}`};return l.shipped||(l.shipped=[]),l.shipped.unshift(i),l[e]=l[e].filter(s=>s.id!==t),k(),g(),i}function tt(){if(!l.shipped)return[];const e=new Date().toISOString().split("T")[0];return l.shipped.filter(t=>t.shippedAt&&t.shippedAt.startsWith(e))}async function Kt(e){w(),l={inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[],shipped:l.shipped||[]},await z(l),g()}async function Yt(){return"serviceWorker"in navigator?!!(await navigator.serviceWorker.ready).active:!1}function Qt(){const e=v();let t=`# Commander

`;t+=`## Inbox
`,e.inbox.length===0?t+=`- (empty)
`:e.inbox.forEach(o=>{t+=`- ${o.text||"(empty)"}
`}),t+=`
`,t+=`## Next
`,e.next.length===0?t+=`- (empty)
`:e.next.forEach(o=>{t+=`- ${o.text||"(empty)"}
`}),t+=`
`,t+=`## Ship Today
`,e.shipToday.length===0?t+=`- (empty)
`:e.shipToday.forEach(o=>{t+=`- ${o.text||"(empty)"}
`}),t+=`
`,t+=`## Logs
`;const n=e.logs||[];return n.length===0?t+=`- (empty)
`:n.forEach(o=>{const a=new Date(o.createdAt).toLocaleString(),r=(o.content.length>100?o.content.substring(0,100)+"...":o.content).replace(/\n/g," ");t+=`- [${a}] ${r}
`}),t}function Zt(){const e=v(),t={version:2,exportedAt:new Date().toISOString(),data:{inbox:e.inbox,next:e.next,shipToday:e.shipToday,logs:e.logs||[]}};return JSON.stringify(t,null,2)}function Ce(e,t,n){const o=new Blob([e],{type:n}),a=URL.createObjectURL(o),i=document.createElement("a");i.href=a,i.download=t,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(a),100)}function Xt(){const e=Qt(),t=new Date().toISOString().split("T")[0];Ce(e,`commander-${t}.md`,"text/markdown")}function en(){const e=Zt(),t=new Date().toISOString().split("T")[0];Ce(e,`commander-${t}.json`,"application/json")}function tn(e){let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format")}const n=t.data||t;if(!n||typeof n!="object")throw new Error("Invalid data structure");const o={inbox:[],next:[],shipToday:[],logs:[]};return["inbox","next","shipToday"].forEach(a=>{Array.isArray(n[a])&&(o[a]=n[a].map(i=>typeof i=="string"?{id:D(),text:i}:i&&typeof i=="object"&&"text"in i?{id:i.id||D(),text:String(i.text||"")}:null).filter(Boolean))}),Array.isArray(n.logs)&&(o.logs=n.logs.map(a=>a&&typeof a=="object"&&"content"in a?{id:a.id||D(),createdAt:a.createdAt||new Date().toISOString(),source:a.source||"manual",route:a.route||"logs",tags:Array.isArray(a.tags)?a.tags:[],content:String(a.content||"")}:null).filter(Boolean)),o}function D(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}function nn(){const e=v(),t={schemaVersion:2,appVersion:"2026-01-05T14:44:22.302Z",createdAt:new Date().toISOString(),backup:!0,data:{inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[]}};return JSON.stringify(t,null,2)}function on(){const e=nn(),t=new Date().toISOString().split("T")[0],n=new Date().toISOString().split("T")[1].split(".")[0].replace(/:/g,"-");Ce(e,`commander-backup-${t}_${n}.json`,"application/json")}function an(e,t){let n;try{n=JSON.parse(e)}catch{throw new Error("Invalid JSON format")}const o=n.data||n;if(!o||typeof o!="object")throw new Error("Invalid backup structure");const a={imported:{inbox:0,next:0,shipToday:0,logs:0},skipped:{inbox:0,next:0,shipToday:0,logs:0}},i={inbox:[...t.inbox||[]],next:[...t.next||[]],shipToday:[...t.shipToday||[]],logs:[...t.logs||[]]};function r(s,c,d){return s.some(f=>f.id===c.id||d&&f[d]===c[d])}return["inbox","next","shipToday"].forEach(s=>{Array.isArray(o[s])&&o[s].forEach(c=>{if(!c)return;const d=typeof c=="string"?{id:D(),text:c}:{id:c.id||D(),text:String(c.text||"")};r(i[s],d,"text")?a.skipped[s]++:(i[s].push(d),a.imported[s]++)})}),Array.isArray(o.logs)&&o.logs.forEach(s=>{if(!s||typeof s!="object"||!s.content)return;const c={id:s.id||D(),createdAt:s.createdAt||new Date().toISOString(),source:s.source||"import",route:s.route||"logs",category:s.category||"Note",tags:Array.isArray(s.tags)?s.tags:[],content:String(s.content||"")};r(i.logs,c,"content")?a.skipped.logs++:(i.logs.push(c),a.imported.logs++)}),i.logs.sort((s,c)=>new Date(c.createdAt)-new Date(s.createdAt)),{...i,stats:a}}const nt=[{id:"bug",icon:"ğŸ›",label:"Bug Report",content:`[BUG] 
Context: 
Expected: 
Actual: `},{id:"idea",icon:"ğŸ’¡",label:"Idea",content:`[IDEA] 
Goal: 
First Step: `},{id:"log",icon:"ğŸªµ",label:"Daily Log",content:`#log 
Wins: 
Blockers: `},{id:"meeting",icon:"ğŸ“…",label:"Meeting Note",content:`[MEETING] 
Who: 
Action Items:
- `},{id:"MissionControl",icon:"ğŸ¯",label:"Morning Mission Control",content:`## ğŸ¯ MISSION CONTROL â€” {{DATE}}

### HUD
- Energy: /10
- Focus Target: 

### BODY
Top 3 Priorities:
{{PREVIOUS_FOCUS}}

### CLOSE BLOCK
- Review at: 
- Success = 

### LOG
#morning #mission-control`},{id:"MicroResearch",icon:"ğŸ”¬",label:"Micro Research Sprint",content:`## ğŸ”¬ MICRO RESEARCH â€” {{DATE}} {{TIME}}

### HUD
- Topic: 
- Time Box: 25min

### BODY
Question: 
Sources:
- 

Key Findings:
- 

### CLOSE BLOCK
Next Step: 

### LOG
#research #micro-sprint`},{id:"BuildBlock",icon:"ğŸ”¨",label:"Daily Build Block",content:`## ğŸ”¨ BUILD BLOCK â€” {{DATE}}

### HUD
- Project: 
- Branch: 
- Time: {{TIME}}

### BODY
Goal: 

Steps:
1. 
2. 
3. 

### CLOSE BLOCK
Definition of Done: 
Commit Message: 

### LOG
#build #dev`},{id:"NightlyDelta",icon:"ğŸŒ™",label:"Nightly System Delta",content:`## ğŸŒ™ NIGHTLY DELTA â€” {{DATE}}

### HUD
- Mood: /10
- Energy EOD: /10

### BODY
Shipped Today:
- 

Blockers Hit:
- 

Tomorrow's Focus:
- 

### CLOSE BLOCK
Gratitude: 
Learning: 

### LOG
#nightly #reflection`},{id:"WeeklyReview",icon:"ğŸ—“ï¸",label:"Weekly Review",content:`## ğŸ—“ï¸ WEEKLY REVIEW â€” {{DATE}}

### HUD
- Week Score: /10
- Big Wins: 

### BODY
Shipped this Week:
{{WEEKLY_LOGS}}

### REFLECTION
- What went well?
- What broke?
- Theme for Next Week: 

### LOG
#weekly #review`}];function ot(){return nt}function at(e,t={}){const n=nt.find(i=>i.id===e||i.id.toLowerCase()===(e==null?void 0:e.toLowerCase()));if(!n)return"";let o=n.content;const a=new Date;return o=o.replace(/\{\{DATE\}\}/g,a.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})),o=o.replace(/\{\{TIME\}\}/g,a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),t.previousFocus?o=o.replace("{{PREVIOUS_FOCUS}}",t.previousFocus):o=o.replace("{{PREVIOUS_FOCUS}}",`1. 
2. 
3. `),t.shippedContext&&(o=o.replace(/- \n/,t.shippedContext+`
`)),t.weeklyLogs?o=o.replace("{{WEEKLY_LOGS}}",t.weeklyLogs):o=o.replace("{{WEEKLY_LOGS}}","-"),o}const rn=[{keywords:["bug","fix","error","fail","broken","crash"],tag:"bug",category:"Bug"},{keywords:["idea","feature","maybe","wish","cool"],tag:"idea",category:"Idea"},{keywords:["meeting","call","sync","discuss","chat","meet"],tag:"meeting",category:"Meeting"},{keywords:["urgent","asap","critical","important","now","high priority"],tag:"urgent",category:"Urgent"},{keywords:["buy","order","purchase","shop","get"],tag:"shopping",category:"Shopping"}],sn=[{id:"urgent",title:"ğŸ”¥ Urgent",tags:["urgent","priority-high"]},{id:"bug",title:"ğŸ› Bugs",tags:["bug","fix"]},{id:"meeting",title:"ğŸ“… Meetings",tags:["meeting"]},{id:"idea",title:"ğŸ’¡ Ideas",tags:["idea"]},{id:"shopping",title:"ğŸ›’ Shopping",tags:["shopping"]},{id:"other",title:"ğŸ“ Tasks",tags:[]}];function cn(e){const t=e.toLowerCase(),n=[];let o=null;return rn.forEach(a=>{a.keywords.some(i=>t.includes(i))&&(n.push(a.tag),o||(o=a.category))}),{tags:n,category:o}}function ln(e){const t=sn.map(n=>({...n,items:[]}));return e.forEach(n=>{const o=(n.tags||[]).map(i=>i.toLowerCase().replace("#",""));let a=!1;for(const i of t)if(i.id!=="other"&&i.tags.some(r=>o.includes(r))){i.items.push(n),a=!0;break}if(!a){const i=t.find(r=>r.id==="other");i&&i.items.push(n)}}),t}let T,xe,E,Be,De,W,F,it,rt,Ee,m,Ue,We,st,Fe,Z,ct;document.querySelector('[data-action="close-menu"]');let S=null;const Ve=document.getElementById("templateBtn"),lt=document.getElementById("templateOverlay"),je=document.getElementById("templateList"),Ge=document.querySelector('[data-action="close-template"]');let y=null,I=null,L=null,te=null,X="",P="list",B=null,V=null;const dt=500,dn={inbox:{icon:"ğŸ“¥",title:"Inbox",className:"section-inbox"},next:{icon:"ğŸ“‹",title:"Next",className:"section-next"},shipToday:{icon:"ğŸš€",title:"Ship Today",className:"section-ship"}};function un(){T=document.getElementById("commander"),xe=document.getElementById("captureView"),E=document.getElementById("saveStatus"),Be=document.getElementById("contextMenu"),De=document.getElementById("logContextMenu"),W=document.getElementById("menuOverlay"),F=document.getElementById("confirmOverlay"),it=document.getElementById("confirmTitle"),rt=document.getElementById("confirmMessage"),Ee=document.getElementById("importInput"),m=document.getElementById("captureTextarea"),Ue=document.getElementById("pasteBtn"),We=document.getElementById("saveLogBtn"),st=document.getElementById("routeSelect"),Fe=document.getElementById("logsSearch"),Z=document.getElementById("logsList"),ct=document.getElementById("logsCount"),Wt(H),S=document.getElementById("quartermasterBtn"),Rn(),document.querySelectorAll("[data-action]").forEach(r=>{r.addEventListener("click",Bn)}),document.querySelectorAll("[data-move]").forEach(r=>{r.addEventListener("click",In)}),document.querySelectorAll("[data-log-action]").forEach(r=>{r.addEventListener("click",Cn)}),Ee.addEventListener("change",An),Ue.addEventListener("click",vn),We.addEventListener("click",kn),Ve&&Ve.addEventListener("click",wn),Ge&&Ge.addEventListener("click",_);const e=document.getElementById("timeBandit");e&&e.addEventListener("click",jn);const t=document.getElementById("micBtn");t&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)&&(t.hidden=!1,t.addEventListener("click",En)),Fe.addEventListener("input",Sn);const n=document.getElementById("viewToggle");n&&n.addEventListener("click",ut);const o=document.getElementById("restoreInput");o&&o.addEventListener("change",$n);const a=document.getElementById("shipOverlay");a&&a.addEventListener("click",r=>{r.target===a&&se()});const i=document.getElementById("templateOverlay");i&&i.addEventListener("click",r=>{r.target===i&&_()}),W.addEventListener("click",r=>{r.target===W&&u()}),F.addEventListener("click",r=>{r.target===F&&M()}),window.addEventListener("online",ue),window.addEventListener("offline",ue),window.addEventListener("commander-command",mn),ue(),document.addEventListener("keydown",qn),H(v(),re(),Q()),vt()}function mn(e){const{command:t,text:n,tags:o,priority:a,silent:i,view:r}=e.detail;switch(console.log("[UI] Received command:",t,e.detail),t){case"add-task":case"add":if(n){let s=[...o],c="inbox";a&&s.push(a==="high"?"#priority":`#${a}`);const d=O(c,n);if(s.length>0){const f=`${n} ${s.join(" ")}`;we(c,d,f)}i||(p(`Added: ${n}`,"success"),navigator.vibrate&&navigator.vibrate(50))}break;case"log":n&&(Ie(n,"automation"),i||p("Log added","info"));break;case"toggle-theme":document.body.classList.toggle("theme-light"),i||p("Theme toggled","info");break;case"focus-mode":i||p("Focus Mode activated","info"),b("tasks");break;case"navigate":r&&b(r);break}}async function ue(){const e=document.getElementById("offlineIndicator");if(!e)return;!navigator.onLine?(e.textContent="ğŸ“¡ Offline",e.className="offline-indicator offline",e.hidden=!1):await Yt()?(e.textContent="ğŸŸ¢ Ready",e.className="offline-indicator",e.hidden=!1):e.hidden=!0}function H(e,t,n){hn(t),pn(n),On(),document.startViewTransition?document.startViewTransition(()=>{He(n,e)}):He(n,e)}function He(e,t){e==="capture"?(T.hidden=!0,xe.hidden=!1,mt(t)):(T.hidden=!1,xe.hidden=!0,gn(t))}function pn(e){document.querySelectorAll(".action-btn-tab").forEach(t=>{const n=t.dataset.action;n==="view-tasks"?t.classList.toggle("active",e==="tasks"):n==="view-capture"&&t.classList.toggle("active",e==="capture")})}function gn(e){var a,i;if(P==="board"){fn(e);return}const t=document.activeElement,n=t&&t.classList.contains("item-content"),o=n?(i=(a=t.closest(".item"))==null?void 0:a.dataset)==null?void 0:i.id:null;if(n&&o){["inbox","next","shipToday"].forEach(r=>{const s=document.querySelector(`[data-section="${r}"] .section-count`);s&&(s.textContent=e[r].length)});return}if(T.innerHTML="",B){const r=document.createElement("div");r.className="filter-bar",r.innerHTML=`
            <span>Filtering: <strong>#${B}</strong></span>
            <button class="filter-clear-btn">âœ• Clear</button>
        `,r.querySelector(".filter-clear-btn").addEventListener("click",Jn),T.appendChild(r)}["inbox","next","shipToday"].forEach(r=>{let s=e[r];B&&(s=s.filter(d=>d.tags&&d.tags.some(f=>f.replace("#","").toLowerCase()===B)));const c=yn(r,s);T.appendChild(c)})}function fn(e){T.innerHTML="";const t=[...e.inbox.map(a=>({...a,_section:"inbox"})),...e.next.map(a=>({...a,_section:"next"})),...e.shipToday.map(a=>({...a,_section:"shipToday"}))],n=ln(t),o=document.createElement("div");o.className="board-container",n.forEach(a=>{const i=document.createElement("div");i.className="board-column",i.classList.add(`board-col-${a.id}`),i.innerHTML=`
            <div class="board-header">
                <span class="board-title">${a.title}</span>
                <span class="board-count">${a.items.length}</span>
            </div>
        `;const r=document.createElement("ul");r.className="board-items",a.items.forEach(s=>{const c=pt(s._section,s);c.classList.add("board-card"),r.appendChild(c)}),i.appendChild(r),o.appendChild(i)}),T.appendChild(o)}function ut(){P=P==="list"?"board":"list";const e=document.getElementById("viewToggle");e&&(e.textContent=P==="list"?"ğŸ“‹":"ğŸ“Š",e.setAttribute("title",P==="list"?"Switch to Smart Board":"Switch to List")),H(v(),re(),"tasks")}function mt(e){const t=X?zt(X):e.logs||[];if(ct.textContent=t.length,Z.innerHTML="",t.length===0){const n=document.createElement("li");n.className="logs-empty",n.textContent=X?"No logs match your search":"No logs yet. Capture something!",Z.appendChild(n)}else t.forEach(n=>{const o=bn(n);Z.appendChild(o)})}function hn(e){switch(E.className="status-indicator",e){case"saving":E.textContent="Savingâ€¦",E.classList.add("saving");break;case"saved":E.textContent="Saved âœ“",E.classList.add("saved");break;case"error":E.textContent="Error!",E.classList.add("error");break;default:E.textContent="Ready"}}function yn(e,t){const n=dn[e],o=document.createElement("section");o.className=`section ${n.className}`,o.dataset.section=e;const a=document.createElement("header");a.className="section-header",a.innerHTML=`
    <span class="section-icon">${n.icon}</span>
    <h2 class="section-title">${n.title}</h2>
    <span class="section-count">${t.length}</span>
  `,o.appendChild(a);const i=document.createElement("ul");if(i.className="section-list",t.length===0){const r=document.createElement("li");r.className="section-empty";const c={inbox:{icon:"ğŸ“¥",text:"Inbox empty â€” capture something!"},next:{icon:"ğŸ¯",text:"Nothing queued up"},shipToday:{icon:"ğŸš€",text:"Ready to ship?"}}[e]||{icon:"ğŸ“­",text:"No items"};r.innerHTML=`<span class="empty-icon">${c.icon}</span><span class="empty-text">${c.text}</span>`,i.appendChild(r)}else t.forEach(r=>{const s=pt(e,r);i.appendChild(s)});return o.appendChild(i),o}function pt(e,t){const n=document.createElement("li");n.className="item",n.dataset.id=t.id,n.dataset.section=e;const o=document.createElement("span");o.className="item-bullet",n.appendChild(o);const a=document.createElement("div");if(a.className="item-content",a.contentEditable="true",a.spellcheck=!0,a.textContent=t.text,a.addEventListener("input",()=>{we(e,t.id,a.textContent)}),a.addEventListener("blur",()=>{const s=a.textContent.trim();s!==t.text&&we(e,t.id,s)}),a.addEventListener("keydown",s=>{if(s.key==="Enter"&&!s.shiftKey){s.preventDefault();const c=O(e,"");requestAnimationFrame(()=>{const d=document.querySelector(`[data-id="${c}"] .item-content`);d&&d.focus()})}s.key==="Backspace"&&a.textContent===""&&(s.preventDefault(),et(e,t.id))}),n.appendChild(a),t.tags&&t.tags.length>0){const s=document.createElement("div");s.className="item-tags",t.tags.forEach(c=>{const d=document.createElement("span");d.className="item-tag",d.textContent=c.startsWith("#")?c:`#${c}`,d.addEventListener("click",f=>{f.stopPropagation(),zn(c)}),s.appendChild(d)}),n.appendChild(s)}const i=()=>{n.classList.add("long-pressing"),L=setTimeout(()=>{n.classList.remove("long-pressing"),Ln(e,t.id)},dt)},r=()=>{n.classList.remove("long-pressing"),L&&(clearTimeout(L),L=null)};return n.addEventListener("touchstart",i,{passive:!0}),n.addEventListener("touchend",r),n.addEventListener("touchcancel",r),n.addEventListener("touchmove",r),n.addEventListener("mousedown",s=>{s.button===0&&i()}),n.addEventListener("mouseup",r),n.addEventListener("mouseleave",r),n}function bn(e){const t=document.createElement("li");t.className="log-item",t.dataset.logId=e.id;const n=new Date(e.createdAt).toLocaleString(),o=e.content.length>50?e.content.substring(0,50).replace(/\n/g," ")+"...":e.content.replace(/\n/g," ");t.innerHTML=`
    <div class="log-item-header">
      <div class="log-item-meta">
        <span class="log-item-date">${n}</span>
        <span class="log-item-preview">${_e(o)}</span>
      </div>
      <span class="log-item-source ${e.source==="clipboard"?"clipboard":""}">${e.source}</span>
    </div>
    <div class="log-item-content">
      <div class="log-item-full-text">${_e(e.content)}</div>
    </div>
  `;const a=t.querySelector(".log-item-header");a.addEventListener("click",()=>{t.classList.toggle("expanded")});const i=()=>{t.classList.add("long-pressing"),L=setTimeout(()=>{t.classList.remove("long-pressing"),Tn(e)},dt)},r=()=>{t.classList.remove("long-pressing"),L&&(clearTimeout(L),L=null)};return a.addEventListener("touchstart",i,{passive:!0}),a.addEventListener("touchend",r),a.addEventListener("touchcancel",r),a.addEventListener("touchmove",r),t}function _e(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function p(e,t="success"){const n=document.getElementById("toast");if(!n)return;const o={success:"âœ…",error:"âŒ",info:"â„¹ï¸",warning:"âš ï¸"},a=o[t]||o.success;n.textContent=`${a} ${e}`,n.className="toast show toast-"+t,navigator.vibrate&&navigator.vibrate(t==="error"?[50,50,50]:50),setTimeout(()=>{n.classList.remove("show")},3e3)}async function vn(){try{const e=await navigator.clipboard.readText();if(!e)return;const t=e.split(`
`).map(a=>a.trim()).filter(a=>a),n=/^(\-|\*|\d+\.)\s+/,o=t.filter(a=>n.test(a));if(o.length>1&&confirm(`Detected ${o.length} list items. Split them into separate Inbox tasks?`)){o.forEach(i=>{const r=i.replace(n,"").trim();r&&O("inbox",r)}),p(`âœ… Added ${o.length} items to Inbox`),b("tasks"),navigator.vibrate&&navigator.vibrate(50);return}m.value=e,m.focus()}catch(e){console.error("Failed to read clipboard:",e),alert("Permission to read clipboard denied.")}}function wn(){xn(),lt.hidden=!1}function _(){lt.hidden=!0}function xn(){const e=ot();je.innerHTML="";const t=document.createElement("div");t.style.cssText="display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr);",e.forEach(n=>{const o=document.createElement("button");o.className="menu-btn",o.style.cssText="height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; text-align: center;",o.innerHTML=`
            <span style="font-size: 24px;">${n.icon}</span>
            <span>${n.label}</span>
        `,o.onclick=()=>gt(n.id),t.appendChild(o)}),je.appendChild(t)}async function gt(e){let t={};if(e==="MissionControl"){const i=(v().logs||[]).find(r=>r.tags&&r.tags.includes("#nightly")||r.saveAs&&r.saveAs.includes("NightlyDelta"));if(i){const r=i.content.match(/Tomorrow's Focus:([\s\S]*?)(?:###|$)/);if(r&&r[1]){const s=r[1].trim().split(`
`).map(c=>c.trim()).filter(c=>c.startsWith("-")).map(c=>c.replace(/^-\s*/,"").trim()).filter(c=>c).map((c,d)=>`${d+1}. ${c}`).join(`
`);s&&(t.previousFocus=s,p("ğŸ”— Ouroboros Linked: Focus recovered","info"))}}}const n=at(e,t);n&&(m.value=n,_(),m.focus())}function En(){const e=document.getElementById("micBtn"),t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return;if(e.classList.contains("recording")){window.recognitionInstance&&window.recognitionInstance.stop();return}const n=new t;window.recognitionInstance=n,n.continuous=!1,n.interimResults=!0,n.lang="en-US",e.classList.add("recording");const o=m.getAttribute("placeholder");m.setAttribute("placeholder","Listening...");let a=m.value;a&&!a.endsWith(" ")&&(a+=" ");let i="";n.onresult=r=>{let s="",c="";for(let x=r.resultIndex;x<r.results.length;++x)r.results[x].isFinal?i+=r.results[x][0].transcript:s+=r.results[x][0].transcript,c+=r.results[x][0].transcript;const d=/^(?:protocol|template)\s+(\w+)(?:\s+(.*))?/i,f=i.trim().match(d);if(f){const x=f[1].toLowerCase(),J=f[2]||"",ce=ot().find(h=>h.id===x||h.label.toLowerCase().includes(x));if(ce){let h=ce.content;J&&(h.includes("Context:")?h=h.replace("Context: ",`Context: ${J}`):h.includes("Goal:")?h=h.replace("Goal: ",`Goal: ${J}`):h+=`
${J}`),m.value=h,p(`ğŸ¤– Protocol Droid: Loaded ${ce.label}`),m.scrollTop=m.scrollHeight,e.classList.remove("recording"),window.recognitionInstance.stop();return}}m.value=a+c,m.scrollTop=m.scrollHeight},n.onend=()=>{e.classList.remove("recording"),m.setAttribute("placeholder",o),window.recognitionInstance=null,navigator.vibrate&&navigator.vibrate(50)},n.onerror=r=>{console.error("Speech recognition error",r.error),e.classList.remove("recording"),m.setAttribute("placeholder",o)},n.start()}function kn(){const e=m.value.trim();if(!e){alert("Nothing to save!");return}const t=st.value,n="manual",{tags:o}=cn(e);Ie(e,n,t,o),m.value="",navigator.vibrate&&navigator.vibrate(50)}function Sn(e){X=e.target.value,mt(v())}function Ln(e,t){y={section:e,id:t},document.querySelectorAll("[data-move]").forEach(n=>{n.hidden=n.dataset.move===e}),Be.hidden=!1,navigator.vibrate&&navigator.vibrate(50)}function ne(){Be.hidden=!0,y=null}function Tn(e){I=e,De.hidden=!1,navigator.vibrate&&navigator.vibrate(50)}function qe(){De.hidden=!0,I=null}function In(e){const t=e.currentTarget.dataset.move;y&&Ft(y.section,t,y.id),ne()}function Cn(e){const t=e.currentTarget.dataset.logAction;if(!I){qe();return}switch(t){case"copy":navigator.clipboard.writeText(I.content).then(()=>{navigator.vibrate&&navigator.vibrate(50)}).catch(()=>{alert("Failed to copy")});break;case"send-inbox":O("inbox",I.content);break;case"send-ship":O("shipToday",I.content);break;case"delete":_t(I.id);break}qe()}function Bn(e){var n;switch(e.currentTarget.dataset.action){case"view-tasks":b("tasks");break;case"view-capture":b("capture");break;case"add-inbox":Q()!=="tasks"&&b("tasks"),me("inbox");break;case"add-next":Q()!=="tasks"&&b("tasks"),me("next");break;case"add-ship":Q()!=="tasks"&&b("tasks"),me("shipToday");break;case"menu":Dn();break;case"close-menu":u();break;case"export-md":Xt(),u();break;case"export-json":en(),u();break;case"import-json":Ee.click();break;case"undo":Gt()?(jt(),u()):alert("Nothing to undo");break;case"clear-all":Ae("Clear All?","This will delete all items in all sections. This cannot be undone.",()=>{Vt(),M(),u()});break;case"delete":y&&(et(y.section,y.id),ne());break;case"cancel":ne();break;case"mark-shipped":y&&ft(y.section,y.id);break;case"confirm-cancel":M();break;case"confirm-yes":te&&te();break;case"backup":on(),u();break;case"restore":(n=document.getElementById("restoreInput"))==null||n.click();break;case"view-shipped":Nn();break;case"close-ship":case"cancel-ship":se();break;case"confirm-ship":Mn();break;case"close-template":_();break;case"diagnostics":Pn();break;case"close-diag":yt();break;case"weekly-export":Un();break;case"check-update":Wn();break;case"reset-cache":Fn();break;case"export-debug":Vn();break;case"ai-setup":u(),window.location.href="./ai-setup.html";break;case"automations":u(),window.location.href="./automations.html";break;case"onboarding":u(),bt();break;case"close-onboarding":Kn();break;case"help-tasks":u(),N("tasks");break;case"help-capture":u(),N("capture");break;case"help-productivity":u(),N("productivity");break;case"help-ai":u(),N("ai");break;case"help-automation":u(),N("automation");break;case"random-tip":u(),Yn();break}}function me(e){const t=O(e,"");requestAnimationFrame(()=>{const n=document.querySelector(`[data-id="${t}"] .item-content`);n&&(n.focus(),n.scrollIntoView({behavior:"smooth",block:"center"}))})}function Dn(){W.hidden=!1}function u(){W.hidden=!0}function Ae(e,t,n){it.textContent=e,rt.textContent=t,te=n,F.hidden=!1}function M(){F.hidden=!0,te=null}async function An(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(t){try{const o=await t.text(),a=tn(o);Ae("Replace All Data?","This will replace all current items with the imported data. Continue?",async()=>{await Ht(a),M(),u()})}catch(o){alert(`Import failed: ${o.message}`)}e.target.value=""}}function On(){const e=document.getElementById("todayShipped");if(!e)return;const t=tt();e.textContent=`${t.length} shipped`}function ft(e,t){V={section:e,id:t};const n=document.getElementById("shipOverlay");n&&(n.hidden=!1);const o=document.getElementById("shipSaveAs"),a=document.getElementById("shipDoD");o&&(o.value=""),a&&(a.value="")}function se(){const e=document.getElementById("shipOverlay");e&&(e.hidden=!0),V=null}function Mn(){var n,o,a,i;if(!V)return;const e=(o=(n=document.getElementById("shipSaveAs"))==null?void 0:n.value)==null?void 0:o.trim(),t=(i=(a=document.getElementById("shipDoD"))==null?void 0:a.value)==null?void 0:i.trim();if(!e){alert("Save As is required");return}if(!t){alert("Definition of Done is required");return}try{Jt(V.section,V.id,e,t),se(),ne(),navigator.vibrate&&navigator.vibrate(100)}catch(r){alert(r.message)}}async function $n(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(t){try{const o=await t.text(),a=an(o,v());Ae("Merge Backup?",`Found ${a.stats.imported.inbox+a.stats.imported.next+a.stats.imported.shipToday} tasks and ${a.stats.imported.logs} logs to import. Duplicates will be skipped. Continue?`,async()=>{await Kt(a),M(),u(),alert(`Imported: ${a.stats.imported.inbox} inbox, ${a.stats.imported.next} next, ${a.stats.imported.shipToday} ship, ${a.stats.imported.logs} logs`)})}catch(o){alert(`Restore failed: ${o.message}`)}e.target.value=""}}function Nn(){const e=tt();if(e.length===0){alert("No items shipped today yet!");return}let t=`Today's Shipped (${e.length}):

`;e.forEach((n,o)=>{t+=`${o+1}. ${n.saveAs}
   DoD: ${n.definitionOfDone}

`}),alert(t),u()}window.openShipModal=ft;const ht="2026-01-05T14:44:22.302Z";function Rn(){if(!S)return;function e(){const t=new Date().getHours(),n=new Date().getDay();let o="",a="",i="";n===0&&t>=18?(o="Weekly Review",a="ğŸ—“ï¸",i="WeeklyReview"):t>=5&&t<10?(o="Plan Day",a="â˜€ï¸",i="MissionControl"):t>=18||t<5?(o="Debrief",a="ğŸŒ™",i="NightlyDelta"):(o="Quick Capture",a="âš¡",i="capture"),S.querySelector(".label").textContent=o,S.querySelector(".icon").textContent=a,S.dataset.action=i,S.hidden=!1}e(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&e()}),S.addEventListener("click",()=>{const t=S.dataset.action;navigator.vibrate&&navigator.vibrate(50),t==="capture"?(b("capture"),m.focus()):gt(t)})}async function Pn(){var o;const e=document.getElementById("diagOverlay");if(!e)return;const t=await Xe();document.getElementById("diagVersion").textContent=ht.split("T")[0]||"dev",document.getElementById("diagSchema").textContent=`v${t.schemaVersion||"unknown"}`,document.getElementById("diagUpdated").textContent=((o=t.lastUpdated)==null?void 0:o.split("T")[0])||"never";const n=t.itemCounts||{};document.getElementById("diagCounts").textContent=`${n.inbox||0} inbox, ${n.next||0} next, ${n.logs||0} logs`,"serviceWorker"in navigator?navigator.serviceWorker.ready.then(a=>{document.getElementById("diagSW").textContent=a.active?"ğŸŸ¢ Active":"ğŸŸ¡ Waiting"}).catch(()=>{document.getElementById("diagSW").textContent="ğŸ”´ Error"}):document.getElementById("diagSW").textContent="âšª Not supported",e.hidden=!1,u()}function yt(){const e=document.getElementById("diagOverlay");e&&(e.hidden=!0)}function Un(){const t=v().logs||[],n=new Date;n.setDate(n.getDate()-7);const o=t.filter(i=>new Date(i.createdAt)>=n);if(o.length===0){alert("No logs from the past 7 days.");return}let a=`# Commander Weekly Export
`;a+=`Exported: ${new Date().toISOString()}
`,a+=`Period: Last 7 days (${o.length} entries)

`,a+=`---

`,o.forEach(i=>{const r=new Date(i.createdAt).toLocaleString(),s=i.category||"Note";a+=`## [${s}] ${i.saveAs||"Untitled"} â€” ${r}

`,a+=i.content+`

`,a+=`---

`}),navigator.clipboard.writeText(a).then(()=>{alert(`Copied ${o.length} logs to clipboard!

Paste into ChatGPT for analysis.`),u()}).catch(()=>{const i=new Blob([a],{type:"text/markdown"}),r=URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download=`commander-weekly-${new Date().toISOString().split("T")[0]}.md`,s.click(),URL.revokeObjectURL(r),u()})}async function Wn(){"serviceWorker"in navigator?(await(await navigator.serviceWorker.ready).update(),alert("Update check complete. If an update is available, it will install automatically.")):alert("Service workers not supported.")}async function Fn(){if(confirm("This will clear cached files. Your data will NOT be lost. Continue?"))try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(t=>caches.delete(t)))}p("Cache cleared. Reloading...","info"),setTimeout(()=>location.reload(!0),500)}catch(e){alert("Failed to clear cache: "+e.message)}}async function Vn(){const e=await Xe(),t={exportedAt:new Date().toISOString(),appVersion:ht,schemaVersion:Se,diagnostics:e,userAgent:navigator.userAgent,online:navigator.onLine,serviceWorker:"serviceWorker"in navigator},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`commander-debug-${new Date().toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(o),yt()}(function(){setTimeout(()=>{const t=document.querySelector("#menuOverlay .modal-body");if(t&&!document.getElementById("dailyDebriefBtn")){const n=document.querySelector('[data-action="weekly-export"]');if(n){const o=document.createElement("button");o.id="dailyDebriefBtn",o.className="menu-btn",o.innerHTML="ğŸ§  Copy Daily Debrief",o.onclick=_n,t.insertBefore(o,n)}}},1e3)})();let A=null,$=0,ke=0;function jn(){if(A){confirm("Cancel current session?")&&(clearInterval(A),A=null,oe(null));return}const e=prompt("Set Focus Timer (minutes):","25");if(!e)return;const t=parseInt(e);isNaN(t)||t<=0||Gn(t)}function Gn(e){ke=e,$=e*60,oe($),navigator.vibrate&&navigator.vibrate([50,50,50]),p(`â³ Focus: ${e}m started`),A=setInterval(()=>{$--,oe($),$<=0&&Hn()},1e3)}function Hn(){clearInterval(A),A=null,oe(null),Ie(`âœ… Focus Session: ${ke}m completed`,"auto","logs",["#focus"]),navigator.vibrate&&navigator.vibrate([200,100,200,100,500]),alert(`Time's Up! ${ke}m Session Logged.`)}function oe(e){const t=document.getElementById("timeBandit");if(!t)return;if(e===null){t.textContent="â³",t.classList.remove("active");return}const n=Math.floor(e/60),o=e%60;t.textContent=`${n}:${o.toString().padStart(2,"0")}`,t.classList.add("active")}async function _n(){const e=qt(),t=new Date().toISOString().split("T")[0],n=e.filter(i=>i.createdAt.startsWith(t));if(n.length===0){p("No logs for today.");return}const o=n.map(i=>`- [${new Date(i.createdAt).toLocaleTimeString()}] ${i.content}`).join(`
`),a=`DATE: ${t}
LOGS:
${o}

PROMPT:
Analyze my day based on these execution logs.
1. What was the highest leverage task?
2. Where was the friction or wasted time?
3. Grade my execution (A-F) with a short explanation.
4. Suggest one improvement for tomorrow.`;try{await navigator.clipboard.writeText(a),p("ğŸ§  Debrief Prompt copied to clipboard!")}catch(i){console.error("Failed to copy",i),p("Failed to copy.")}}function qn(e){const t=e.target.tagName.toLowerCase();if(t==="input"||t==="textarea"||e.target.isContentEditable){e.key==="Escape"&&e.target.blur();return}if(e.key==="Escape"){u(),M(),closeContextMenu(),se(),_();return}if(e.key==="n"||e.key==="N"){e.preventDefault(),b("capture"),setTimeout(()=>m==null?void 0:m.focus(),100),p("New capture","info");return}if(e.key==="1"){pe("inbox"),p("ğŸ“¥ Inbox","info");return}if(e.key==="2"){pe("next"),p("ğŸ“‹ Next","info");return}if(e.key==="3"){pe("shipToday"),p("ğŸš€ Ship Today","info");return}if(e.key==="?"||e.key==="h"){p("Shortcuts: n=new, 1/2/3=sections, Esc=close","info");return}if(e.key==="b"||e.key==="B"){ut();return}}function pe(e){const t=document.querySelector(`[data-section="${e}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function zn(e){const t=e.replace("#","").toLowerCase();B=t,p(`Filtering: #${t}`,"info"),H(v(),re(),"tasks")}function Jn(){B=null,p("Filter cleared"),H(v(),re(),"tasks")}function bt(){const e=document.getElementById("onboardingOverlay");e&&(e.hidden=!1)}function Kn(){const e=document.getElementById("onboardingOverlay");e&&(e.hidden=!0),localStorage.setItem("commander-onboarded","true")}function vt(){localStorage.getItem("commander-onboarded")||bt()}function N(e){const t={tasks:{title:"ğŸ“‹ Task Management",items:["ğŸ“¥ **Inbox**: Capture everything here first","ğŸ“‹ **Next**: Things you'll do this week","ğŸš€ **Ship Today**: Your 3-5 focus items","ğŸ’¡ Swipe right on a task to move it forward","ğŸ”„ Long-press for more options"]},capture:{title:"âœï¸ Capture",items:["ğŸ“‹ Paste clipboard content with one tap","ğŸ™ï¸ Use voice capture for hands-free input","ğŸ“ Templates pre-fill common log formats","ğŸ”— Share from any app to capture URLs","â° Use timestamps to track when things happened"]},productivity:{title:"ğŸ¯ Productivity Tools",items:["ğŸ”’ **Focus Mode**: Shows only Ship Today","ğŸ… **Pomodoro**: 25-min focus sessions","âŒ¨ï¸ **Keyboard**: Press ? for shortcuts","ğŸ”¥ **Streak**: Clear inbox daily for streak","ğŸ“Š **Board View**: See tasks by category"]},ai:{title:"ğŸ¤– AI Integration",items:["ğŸ¯ **Prioritize**: AI ranks your tasks","ğŸ”¨ **Break Down**: Split big tasks into steps","ğŸ“… **Plan Day**: Get a time-blocked schedule","ğŸ’¡ All prompts copy to clipboard","âœ¨ Paste into ChatGPT/Gemini for free AI!"]},automation:{title:"ğŸ”— Automation",items:["ğŸ“± **MacroDroid**: Trigger actions via URLs","ğŸ”‡ **Silent Mode**: Add tasks in background","ğŸ·ï¸ **Auto-tags**: URLs can include tags","âš¡ **Commands**: add, log, toggle-theme","ğŸ“„ Visit /automation.html for all links"]}},n=t[e]||t.tasks;Qn(n.title,n.items.map(o=>`â€¢ ${o}`).join(`
`))}function Yn(){const e=["ğŸ’¡ Press ? anytime to see keyboard shortcuts","ğŸ’¡ Swipe right on a task to move it to the next section","ğŸ’¡ Long-press any task for more options","ğŸ’¡ Click on a #tag to filter by that tag","ğŸ’¡ Use Focus Mode to hide distractions","ğŸ’¡ The Quartermaster button changes based on time of day","ğŸ’¡ Export your data weekly for backup","ğŸ’¡ AI features work without API keys - just paste into ChatGPT!","ğŸ’¡ Morning is for planning, evening for reflection","ğŸ’¡ Keep Ship Today to 3-5 items max","ğŸ’¡ Use voice capture while driving (be safe!)","ğŸ’¡ Share from any app to quickly capture URLs","ğŸ’¡ Inbox Zero streaks motivate daily clearing","ğŸ’¡ Board View groups tasks by category automatically"],t=e[Math.floor(Math.random()*e.length)];p(t,"info")}function Qn(e,t){const n=document.getElementById("helpModal");n&&n.remove();const o=document.createElement("div");o.id="helpModal",o.className="modal-overlay",o.innerHTML=`
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h2>${e}</h2>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
            </div>
            <div class="modal-body" style="white-space: pre-line; line-height: 1.8; font-size: 14px;">
                ${t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}
            </div>
        </div>
    `,o.addEventListener("click",a=>{a.target===o&&o.remove()}),document.body.appendChild(o)}vt();function Zn(){const e=new URLSearchParams(window.location.search);if(e.get("safemode")==="1")return{safemode:!0};const t=e.get("screen"),n=e.get("view"),o=e.get("text"),a=e.get("template"),i=e.get("command"),r=e.get("tags"),s=e.get("priority"),c=e.get("silent")==="1"||e.get("silent")==="true",d=e.get("autofocus")==="1";return!t&&!n&&!o&&!a&&!i?null:{view:n||Xn(t)||(o?"capture":null),template:eo(t)||a,text:o,command:i,tags:r?r.split(",").map(f=>f.trim()):[],priority:s,silent:c,autofocus:d,originalParams:e}}function Xn(e){return e?{"mission-control":"capture","micro-research":"capture","build-block":"capture","nightly-delta":"capture",capture:"capture",tasks:"tasks",inbox:"tasks"}[e]:null}function eo(e){return e?{"mission-control":"MissionControl","micro-research":"MicroResearch","build-block":"BuildBlock","nightly-delta":"NightlyDelta"}[e]:null}function to(e,t){if(e){if(console.log("[Integrations] Applying launch params:",e),e.command||e.tags.length>0||e.priority||e.silent||e.text){const n=new CustomEvent("commander-command",{detail:e});window.dispatchEvent(n)}if(e.view&&t(e.view),e.view==="capture"&&setTimeout(()=>{const n=document.getElementById("captureTextarea");if(n){if(e.text&&!e.command)n.value=e.text;else if(e.template){const o=new CustomEvent("commander-fill-template",{detail:{template:e.template}});window.dispatchEvent(o)}(e.autofocus||e.text)&&!e.silent&&(n.focus(),n.value&&(n.selectionStart=n.selectionEnd=n.value.length))}},100),window.history.replaceState){const n=window.location.pathname+(e.safemode?"?safemode=1":"");window.history.replaceState({},document.title,n)}}}const wt="2026-01-05T14:44:22.302Z";async function ze(){console.log(`[Commander] Starting v${wt}...`);const e=Zn();if(e!=null&&e.safemode){no();return}try{await q(),console.log("[Commander] Database initialized"),await Pe(),console.log("[Commander] State loaded"),un(),console.log("[Commander] UI initialized"),to(e,b),window.addEventListener("commander-fill-template",t=>{const n=document.getElementById("captureTextarea");n&&t.detail.template&&(n.value=at(t.detail.template,{}))}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(console.log("[Commander] App visible, refreshing state"),Pe())}),console.log("[Commander] Ready!")}catch(t){console.error("[Commander] Bootstrap failed:",t),oo(t)}}function no(){document.body.innerHTML=`
    <div style="padding: 20px; font-family: sans-serif; background: #0a0a0f; color: #f0f0f5; min-height: 100vh;">
      <h1 style="color: #f59e0b;">ğŸ›¡ï¸ Commander Safe Mode</h1>
      <p style="color: #a0a0b0; margin: 16px 0;">Running in minimal mode for recovery and debugging.</p>
      
      <div style="margin: 24px 0; display: flex; flex-direction: column; gap: 12px;">
        <button onclick="exportEmergencyBackup()" style="padding: 16px; background: #00d4ff; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          ğŸ“¦ Export Emergency Backup
        </button>
        <button onclick="location.href='./?'" style="padding: 16px; background: #1a1a24; color: #f0f0f5; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          ğŸ”„ Try Normal Mode
        </button>
        <button onclick="clearAndReload()" style="padding: 16px; background: #ef4444; color: #fff; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          ğŸ—‘ï¸ Clear Cache & Reload
        </button>
      </div>
      
      <div style="background: #12121a; padding: 16px; border-radius: 8px; margin-top: 24px;">
        <h3 style="margin-bottom: 12px;">Diagnostics</h3>
        <p style="font-size: 14px; color: #606070;">Version: ${wt}</p>
        <p style="font-size: 14px; color: #606070;" id="swStatus">Service Worker: Checking...</p>
        <p style="font-size: 14px; color: #606070;" id="dbStatus">Database: Checking...</p>
      </div>
    </div>
  `,"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{document.getElementById("swStatus").textContent="Service Worker: "+(e.active?"ğŸŸ¢ Active":"ğŸŸ¡ Waiting")}).catch(()=>{document.getElementById("swStatus").textContent="Service Worker: ğŸ”´ Error"});try{const e=indexedDB.open("commander-db");e.onsuccess=()=>{document.getElementById("dbStatus").textContent="Database: ğŸŸ¢ Accessible"},e.onerror=()=>{document.getElementById("dbStatus").textContent="Database: ğŸ”´ Error"}}catch{document.getElementById("dbStatus").textContent="Database: ğŸ”´ Failed"}window.exportEmergencyBackup=async function(){try{const e=indexedDB.open("commander-db",3);e.onsuccess=()=>{const a=e.result.transaction("documents","readonly").objectStore("documents").get("main");a.onsuccess=()=>{const i=a.result||{},r=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),s=URL.createObjectURL(r),c=document.createElement("a");c.href=s,c.download=`commander-emergency-${new Date().toISOString().split("T")[0]}.json`,c.click(),URL.revokeObjectURL(s)}}}catch(e){alert("Export failed: "+e.message)}},window.clearAndReload=async function(){if(confirm("This will clear cached files (not your data). Continue?")){if("caches"in window){const e=await caches.keys();await Promise.all(e.map(t=>caches.delete(t)))}location.reload()}}}function oo(e){document.body.innerHTML=`
    <div style="padding: 20px; font-family: sans-serif; background: #0a0a0f; color: #f0f0f5; min-height: 100vh;">
      <h1 style="color: #ef4444;">âš ï¸ Commander Failed to Start</h1>
      <p style="color: #a0a0b0; margin: 16px 0;">${e.message}</p>
      
      <div style="margin: 24px 0; display: flex; flex-direction: column; gap: 12px;">
        <button onclick="location.reload()" style="padding: 16px; background: #00d4ff; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          ğŸ”„ Try Again
        </button>
        <button onclick="location.href='./?safemode=1'" style="padding: 16px; background: #f59e0b; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          ğŸ›¡ï¸ Enter Safe Mode
        </button>
      </div>
      
      <details style="margin-top: 24px; background: #12121a; padding: 16px; border-radius: 8px;">
        <summary style="cursor: pointer; color: #606070;">Technical Details</summary>
        <pre style="font-size: 12px; color: #ef4444; margin-top: 12px; overflow-x: auto;">${e.stack||e}</pre>
      </details>
    </div>
  `}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ze):ze();
