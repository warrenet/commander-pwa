import"./style-eV2glYNL.js";const v="commander-db",b=3;function x(){return new Promise((r,a)=>{const t=indexedDB.open(v,b);t.onerror=()=>a(t.error),t.onsuccess=()=>r(t.result),t.onupgradeneeded=u=>{const s=u.target.result;s.objectStoreNames.contains("documents")||s.createObjectStore("documents",{keyPath:"id"}),s.objectStoreNames.contains("pending")||s.createObjectStore("pending",{keyPath:"id"})}})}const c=new URLSearchParams(window.location.search),w=c.get("title")||"",f=c.get("text")||"",h=c.get("url")||"",S=c.get("auto")==="true",p=c.get("source");let e="";w&&(e+=w+`

`);f&&(e+=f+`

`);h&&(e+=h);e=e.trim();function B(r){const a=document.createElement("div");return a.textContent=r,a.innerHTML}e||(e="(No content shared)");document.getElementById("sharedContent").textContent=e;function D(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}S&&e&&setTimeout(()=>{window.save()},100);window.cancel=function(){window.location.href="./index.html"};window.save=async function(){const r=document.getElementById("category").value,a=document.getElementById("saveAs").value.trim();let t=document.getElementById("tags").value.trim(),u=r,s="logs";p==="ai"&&(t&&(t+=", "),t+="#ai-suggestion",s="inbox");const y=t?t.split(",").map(d=>d.trim()).filter(Boolean):[],m={id:D(),createdAt:new Date().toISOString(),source:p||"share",route:s,category:u,saveAs:a,tags:y,content:B(e)};try{const g=(await x()).transaction("documents","readwrite").objectStore("documents");let n=await new Promise((i,l)=>{const o=g.get("main");o.onsuccess=()=>i(o.result),o.onerror=()=>l(o.error)});if(n||(n={id:"main",inbox:[],next:[],shipToday:[],logs:[],shipped:[],schemaVersion:3}),n.logs||(n.logs=[]),n.logs.slice(0,5).some(i=>i.content===m.content)){alert("This content was already saved recently.");return}n.logs.unshift(m),n.updatedAt=Date.now(),await new Promise((i,l)=>{const o=g.put(n);o.onsuccess=()=>i(),o.onerror=()=>l(o.error)}),document.getElementById("toast").classList.add("show"),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{window.location.href="./index.html"},1500)}catch(d){alert("Failed to save: "+d.message)}};
