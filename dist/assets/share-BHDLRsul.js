import"./style-eV2glYNL.js";const h="commander-db",p=3;function v(){return new Promise((a,r)=>{const e=indexedDB.open(h,p);e.onerror=()=>r(e.error),e.onsuccess=()=>a(e.result),e.onupgradeneeded=u=>{const s=u.target.result;s.objectStoreNames.contains("documents")||s.createObjectStore("documents",{keyPath:"id"}),s.objectStoreNames.contains("pending")||s.createObjectStore("pending",{keyPath:"id"})}})}const d=new URLSearchParams(window.location.search),g=d.get("title")||"",w=d.get("text")||"",f=d.get("url")||"",y=d.get("auto")==="true";let t="";g&&(t+=g+`

`);w&&(t+=w+`

`);f&&(t+=f);t=t.trim();function b(a){const r=document.createElement("div");return r.textContent=a,r.innerHTML}t||(t="(No content shared)");document.getElementById("sharedContent").textContent=t;function x(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}y&&t&&setTimeout(()=>{window.save()},100);window.cancel=function(){window.location.href="./index.html"};window.save=async function(){const a=document.getElementById("category").value,r=document.getElementById("saveAs").value.trim(),e=document.getElementById("tags").value.trim(),u=e?e.split(",").map(i=>i.trim()).filter(Boolean):[],s={id:x(),createdAt:new Date().toISOString(),source:"share",route:"logs",category:a,saveAs:r,tags:u,content:b(t)};try{const l=(await v()).transaction("documents","readwrite").objectStore("documents");let n=await new Promise((c,m)=>{const o=l.get("main");o.onsuccess=()=>c(o.result),o.onerror=()=>m(o.error)});if(n||(n={id:"main",inbox:[],next:[],shipToday:[],logs:[],shipped:[],schemaVersion:3}),n.logs||(n.logs=[]),n.logs.slice(0,5).some(c=>c.content===s.content)){alert("This content was already saved recently.");return}n.logs.unshift(s),n.updatedAt=Date.now(),await new Promise((c,m)=>{const o=l.put(n);o.onsuccess=()=>c(),o.onerror=()=>m(o.error)}),document.getElementById("toast").classList.add("show"),navigator.vibrate&&navigator.vibrate(50),setTimeout(()=>{window.location.href="./index.html"},1500)}catch(i){alert("Failed to save: "+i.message)}};
