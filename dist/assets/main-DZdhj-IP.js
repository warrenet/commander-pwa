import"./style-CdRYQMGF.js";const ge=(e,t)=>t.some(n=>e instanceof n);let Ae,Oe;function wt(){return Ae||(Ae=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Et(){return Oe||(Oe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pe=new WeakMap,ce=new WeakMap,oe=new WeakMap;function xt(e){const t=new Promise((n,i)=>{const o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",r)},a=()=>{n(C(e.result)),o()},r=()=>{i(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",r)});return oe.set(t,e),t}function St(e){if(pe.has(e))return;const t=new Promise((n,i)=>{const o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",r),e.removeEventListener("abort",r)},a=()=>{n(),o()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",r),e.addEventListener("abort",r)});pe.set(e,t)}let fe={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return pe.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return C(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ze(e){fe=e(fe)}function kt(e){return Et().includes(e)?function(...t){return e.apply(he(this),t),C(this.request)}:function(...t){return C(e.apply(he(this),t))}}function Lt(e){return typeof e=="function"?kt(e):(e instanceof IDBTransaction&&St(e),ge(e,wt())?new Proxy(e,fe):e)}function C(e){if(e instanceof IDBRequest)return xt(e);if(ce.has(e))return ce.get(e);const t=Lt(e);return t!==e&&(ce.set(e,t),oe.set(t,e)),t}const he=e=>oe.get(e);function It(e,t,{blocked:n,upgrade:i,blocking:o,terminated:a}={}){const r=indexedDB.open(e,t),s=C(r);return i&&r.addEventListener("upgradeneeded",c=>{i(C(r.result),c.oldVersion,c.newVersion,C(r.transaction),c)}),n&&r.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),s.then(c=>{a&&c.addEventListener("close",()=>a()),o&&c.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),s}const Tt=["get","getKey","getAll","getAllKeys","count"],Ct=["put","add","delete","clear"],le=new Map;function Me(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(le.get(t))return le.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,o=Ct.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(o||Tt.includes(n)))return;const a=async function(r,...s){const c=this.transaction(r,o?"readwrite":"readonly");let d=c.store;return i&&(d=d.index(s.shift())),(await Promise.all([d[n](...s),o&&c.done]))[0]};return le.set(t,a),a}ze(e=>({...e,get:(t,n,i)=>Me(t,n)||e.get(t,n,i),has:(t,n)=>!!Me(t,n)||e.has(t,n)}));const Bt=["continue","continuePrimaryKey","advance"],$e={},ye=new WeakMap,Je=new WeakMap,Dt={get(e,t){if(!Bt.includes(t))return e[t];let n=$e[t];return n||(n=$e[t]=function(...i){ye.set(this,Je.get(this)[t](...i))}),n}};async function*At(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Dt);for(Je.set(n,t),oe.set(n,he(t));t;)yield n,t=await(ye.get(n)||t.continue()),ye.delete(n)}function Ne(e,t){return t===Symbol.asyncIterator&&ge(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ge(e,[IDBIndex,IDBObjectStore])}ze(e=>({...e,get(t,n,i){return Ne(t,n)?At:e.get(t,n,i)},has(t,n){return Ne(t,n)||e.has(t,n)}}));const Ke="commander-db",Ye=3,V="documents",j="pending",Se=3;let N=null;async function G(){return N||(N=await It(Ke,Ye,{upgrade(e,t,n){console.log(`[DB] Upgrading from v${t} to v${n}`),e.objectStoreNames.contains(V)||e.createObjectStore(V,{keyPath:"id"}),e.objectStoreNames.contains(j)||e.createObjectStore(j,{keyPath:"id"})}}),await Ot(),N)}async function Ot(){const e=await N.get(V,"main");if(!e)return;let t=!1;const n={...e};n.schemaVersion||(console.log("[DB] Migrating: Adding schemaVersion"),n.schemaVersion=1,t=!0),n.schemaVersion<2&&(console.log("[DB] Migrating v1 ‚Üí v2: Ensuring logs array"),Array.isArray(n.logs)||(n.logs=[]),n.schemaVersion=2,t=!0),n.schemaVersion<3&&(console.log("[DB] Migrating v2 ‚Üí v3: Ensuring shipped array"),Array.isArray(n.shipped)||(n.shipped=[]),["inbox","next","shipToday"].forEach(i=>{Array.isArray(n[i])&&(n[i]=n[i].map((o,a)=>o.id?o:{...o,id:`migrated_${i}_${a}_${Date.now()}`}))}),n.schemaVersion=3,t=!0),t&&(console.log("[DB] Saving migrated document"),await q(n))}async function q(e){const n=(await G()).transaction(V,"readwrite");await n.store.put({id:"main",schemaVersion:Se,...e,updatedAt:Date.now()}),await n.done,await $t()}async function Qe(){const e=await G(),t=await e.get(j,"main");return t?(console.log("[DB] Recovering from pending write"),await q(t),t):e.get(V,"main")}async function Mt(e){const n=(await G()).transaction(j,"readwrite");await n.store.put({id:"main",...e,pendingAt:Date.now()}),await n.done}async function $t(){const t=(await G()).transaction(j,"readwrite");await t.store.delete("main"),await t.done}function ke(){return{schemaVersion:Se,inbox:[],next:[],shipToday:[],logs:[],shipped:[]}}async function Ze(){var e,t,n,i,o;try{const a=await Qe();return{dbName:Ke,dbVersion:Ye,schemaVersion:(a==null?void 0:a.schemaVersion)||"unknown",itemCounts:{inbox:((e=a==null?void 0:a.inbox)==null?void 0:e.length)||0,next:((t=a==null?void 0:a.next)==null?void 0:t.length)||0,shipToday:((n=a==null?void 0:a.shipToday)==null?void 0:n.length)||0,logs:((i=a==null?void 0:a.logs)==null?void 0:i.length)||0,shipped:((o=a==null?void 0:a.shipped)==null?void 0:o.length)||0},lastUpdated:a!=null&&a.updatedAt?new Date(a.updatedAt).toISOString():"never"}}catch(a){return{error:a.message}}}const Nt=[{pattern:/\b(buy|get|pick up|grab|shop)\b/i,tag:"#errand"},{pattern:/\b(groceries|store|market)\b/i,tag:"#errand"},{pattern:/\b(fix|debug|code|deploy|refactor|test)\b/i,tag:"#dev"},{pattern:/\b(bug|error|crash|issue)\b/i,tag:"#dev"},{pattern:/\b(API|database|server|frontend|backend)\b/i,tag:"#dev"},{pattern:/\b(call|email|text|message|reach out|contact)\b/i,tag:"#comms"},{pattern:/\b(meet|meeting|sync|standup)\b/i,tag:"#comms"},{pattern:/\b(exercise|workout|gym|run|walk|yoga)\b/i,tag:"#health"},{pattern:/\b(doctor|dentist|appointment|medication)\b/i,tag:"#health"},{pattern:/\b(pay|bill|invoice|budget|expense|money)\b/i,tag:"#finance"},{pattern:/\b(bank|transfer|deposit)\b/i,tag:"#finance"},{pattern:/\b(read|learn|study|research|course)\b/i,tag:"#learn"},{pattern:/\b(book|article|tutorial|video)\b/i,tag:"#learn"},{pattern:/\b(clean|organize|laundry|dishes|vacuum)\b/i,tag:"#home"},{pattern:/\b(repair|fix|maintenance)\b/i,tag:"#home"},{pattern:/\b(report|presentation|proposal|deadline)\b/i,tag:"#work"},{pattern:/\b(client|project|task|review)\b/i,tag:"#work"},{pattern:/\b(urgent|asap|important|critical)\b/i,tag:"#priority"},{pattern:/\b(today|now|immediately)\b/i,tag:"#priority"},{pattern:/\b(waiting|blocked|pending|on hold)\b/i,tag:"#waiting"}];function Rt(e){if(!e||typeof e!="string")return[];const t=new Set;for(const n of Nt)n.pattern.test(e)&&t.add(n.tag);return Array.from(t)}let l=ke(),P=null,K=null;const be=new Set;let ie="idle",Le="tasks";const Pt=300;function X(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}function v(){return l}function ae(){return ie}function Y(){return Le}function b(e){Le=e,p()}function Wt(e){return be.add(e),()=>be.delete(e)}function p(){be.forEach(e=>e(l,ie,Le))}function J(e){ie=e,p()}function S(){K&&clearTimeout(K),Mt(l).catch(console.error),J("saving"),K=setTimeout(async()=>{try{await q(l),J("saved"),setTimeout(()=>{ie==="saved"&&J("idle")},2e3)}catch(e){console.error("[State] Save failed:",e),J("error")}},Pt)}function w(){P=JSON.parse(JSON.stringify(l))}async function Re(){try{const e=await Qe();e&&(l={inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[]}),p()}catch(e){console.error("[State] Failed to load:",e),l=ke(),p()}}function O(e,t="",n=[]){w();const i=Rt(t),o=[...new Set([...n,...i])],a={id:X(),text:t,tags:o.length>0?o:void 0,createdAt:Date.now()};return l[e]=[...l[e],a],S(),p(),a.id}function ve(e,t,n){l[e].findIndex(o=>o.id===t)!==-1&&(K||w(),l[e]=l[e].map(o=>o.id===t?{...o,text:n}:o),S(),p())}function Xe(e,t){w(),l[e]=l[e].filter(n=>n.id!==t),S(),p()}function Ut(e,t,n){if(e===t)return;w();const i=l[e].find(o=>o.id===n);i&&(l[e]=l[e].filter(o=>o.id!==n),l[t]=[...l[t],i],S(),p())}function Ft(){w(),l=ke(),S(),p()}function Vt(){if(!P)return!1;const e=l;return l=P,P=e,S(),p(),!0}function jt(){return P!==null}async function Ht(e){w(),l={inbox:Array.isArray(e.inbox)?e.inbox:[],next:Array.isArray(e.next)?e.next:[],shipToday:Array.isArray(e.shipToday)?e.shipToday:[],logs:Array.isArray(e.logs)?e.logs:[]},await q(l),p()}function Ie(e,t="manual",n="logs",i=[]){w();const o=e.trim();if(l.logs.length>0){const r=l.logs[0];if(r.content===o)return console.log("[State] Duplicate log ignored"),r.id}const a={id:X(),createdAt:new Date().toISOString(),source:t,route:n,tags:i,content:o};if(l.logs=[a,...l.logs],n==="inbox"||n==="next"||n==="shipToday"){const r={id:X(),text:e.trim()};l[n]=[...l[n],r]}return S(),p(),a.id}function _t(e){w(),l.logs=l.logs.filter(t=>t.id!==e),S(),p()}function Gt(){return l.logs||[]}function qt(e){if(!e||!e.trim())return l.logs||[];const t=e.toLowerCase().trim();return(l.logs||[]).filter(n=>n.content.toLowerCase().includes(t)||n.tags.some(i=>i.toLowerCase().includes(t)))}function zt(e,t,n,i){var r;if(!n||!n.trim())throw new Error("Save As is required");if(!i||!i.trim())throw new Error("Definition of Done is required");w();const o=(r=l[e])==null?void 0:r.find(s=>s.id===t);if(!o)return null;const a={id:X(),originalId:t,text:o.text,saveAs:n.trim(),definitionOfDone:i.trim(),shippedAt:new Date().toISOString(),fromSection:e,logLine:`${new Date().toLocaleTimeString()} | SHIPPED: ${n.trim()} ‚Äî DoD: ${i.trim()}`};return l.shipped||(l.shipped=[]),l.shipped.unshift(a),l[e]=l[e].filter(s=>s.id!==t),S(),p(),a}function et(){if(!l.shipped)return[];const e=new Date().toISOString().split("T")[0];return l.shipped.filter(t=>t.shippedAt&&t.shippedAt.startsWith(e))}async function Jt(e){w(),l={inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[],shipped:l.shipped||[]},await q(l),p()}async function Kt(){return"serviceWorker"in navigator?!!(await navigator.serviceWorker.ready).active:!1}function Yt(){const e=v();let t=`# Commander

`;t+=`## Inbox
`,e.inbox.length===0?t+=`- (empty)
`:e.inbox.forEach(i=>{t+=`- ${i.text||"(empty)"}
`}),t+=`
`,t+=`## Next
`,e.next.length===0?t+=`- (empty)
`:e.next.forEach(i=>{t+=`- ${i.text||"(empty)"}
`}),t+=`
`,t+=`## Ship Today
`,e.shipToday.length===0?t+=`- (empty)
`:e.shipToday.forEach(i=>{t+=`- ${i.text||"(empty)"}
`}),t+=`
`,t+=`## Logs
`;const n=e.logs||[];return n.length===0?t+=`- (empty)
`:n.forEach(i=>{const o=new Date(i.createdAt).toLocaleString(),r=(i.content.length>100?i.content.substring(0,100)+"...":i.content).replace(/\n/g," ");t+=`- [${o}] ${r}
`}),t}function Qt(){const e=v(),t={version:2,exportedAt:new Date().toISOString(),data:{inbox:e.inbox,next:e.next,shipToday:e.shipToday,logs:e.logs||[]}};return JSON.stringify(t,null,2)}function Te(e,t,n){const i=new Blob([e],{type:n}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(o),100)}function Zt(){const e=Yt(),t=new Date().toISOString().split("T")[0];Te(e,`commander-${t}.md`,"text/markdown")}function Xt(){const e=Qt(),t=new Date().toISOString().split("T")[0];Te(e,`commander-${t}.json`,"application/json")}function en(e){let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format")}const n=t.data||t;if(!n||typeof n!="object")throw new Error("Invalid data structure");const i={inbox:[],next:[],shipToday:[],logs:[]};return["inbox","next","shipToday"].forEach(o=>{Array.isArray(n[o])&&(i[o]=n[o].map(a=>typeof a=="string"?{id:D(),text:a}:a&&typeof a=="object"&&"text"in a?{id:a.id||D(),text:String(a.text||"")}:null).filter(Boolean))}),Array.isArray(n.logs)&&(i.logs=n.logs.map(o=>o&&typeof o=="object"&&"content"in o?{id:o.id||D(),createdAt:o.createdAt||new Date().toISOString(),source:o.source||"manual",route:o.route||"logs",tags:Array.isArray(o.tags)?o.tags:[],content:String(o.content||"")}:null).filter(Boolean)),i}function D(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}function tn(){const e=v(),t={schemaVersion:2,appVersion:"2026-01-05T14:31:51.719Z",createdAt:new Date().toISOString(),backup:!0,data:{inbox:e.inbox||[],next:e.next||[],shipToday:e.shipToday||[],logs:e.logs||[]}};return JSON.stringify(t,null,2)}function nn(){const e=tn(),t=new Date().toISOString().split("T")[0],n=new Date().toISOString().split("T")[1].split(".")[0].replace(/:/g,"-");Te(e,`commander-backup-${t}_${n}.json`,"application/json")}function on(e,t){let n;try{n=JSON.parse(e)}catch{throw new Error("Invalid JSON format")}const i=n.data||n;if(!i||typeof i!="object")throw new Error("Invalid backup structure");const o={imported:{inbox:0,next:0,shipToday:0,logs:0},skipped:{inbox:0,next:0,shipToday:0,logs:0}},a={inbox:[...t.inbox||[]],next:[...t.next||[]],shipToday:[...t.shipToday||[]],logs:[...t.logs||[]]};function r(s,c,d){return s.some(f=>f.id===c.id||d&&f[d]===c[d])}return["inbox","next","shipToday"].forEach(s=>{Array.isArray(i[s])&&i[s].forEach(c=>{if(!c)return;const d=typeof c=="string"?{id:D(),text:c}:{id:c.id||D(),text:String(c.text||"")};r(a[s],d,"text")?o.skipped[s]++:(a[s].push(d),o.imported[s]++)})}),Array.isArray(i.logs)&&i.logs.forEach(s=>{if(!s||typeof s!="object"||!s.content)return;const c={id:s.id||D(),createdAt:s.createdAt||new Date().toISOString(),source:s.source||"import",route:s.route||"logs",category:s.category||"Note",tags:Array.isArray(s.tags)?s.tags:[],content:String(s.content||"")};r(a.logs,c,"content")?o.skipped.logs++:(a.logs.push(c),o.imported.logs++)}),a.logs.sort((s,c)=>new Date(c.createdAt)-new Date(s.createdAt)),{...a,stats:o}}const tt=[{id:"bug",icon:"üêõ",label:"Bug Report",content:`[BUG] 
Context: 
Expected: 
Actual: `},{id:"idea",icon:"üí°",label:"Idea",content:`[IDEA] 
Goal: 
First Step: `},{id:"log",icon:"ü™µ",label:"Daily Log",content:`#log 
Wins: 
Blockers: `},{id:"meeting",icon:"üìÖ",label:"Meeting Note",content:`[MEETING] 
Who: 
Action Items:
- `},{id:"MissionControl",icon:"üéØ",label:"Morning Mission Control",content:`## üéØ MISSION CONTROL ‚Äî {{DATE}}

### HUD
- Energy: /10
- Focus Target: 

### BODY
Top 3 Priorities:
{{PREVIOUS_FOCUS}}

### CLOSE BLOCK
- Review at: 
- Success = 

### LOG
#morning #mission-control`},{id:"MicroResearch",icon:"üî¨",label:"Micro Research Sprint",content:`## üî¨ MICRO RESEARCH ‚Äî {{DATE}} {{TIME}}

### HUD
- Topic: 
- Time Box: 25min

### BODY
Question: 
Sources:
- 

Key Findings:
- 

### CLOSE BLOCK
Next Step: 

### LOG
#research #micro-sprint`},{id:"BuildBlock",icon:"üî®",label:"Daily Build Block",content:`## üî® BUILD BLOCK ‚Äî {{DATE}}

### HUD
- Project: 
- Branch: 
- Time: {{TIME}}

### BODY
Goal: 

Steps:
1. 
2. 
3. 

### CLOSE BLOCK
Definition of Done: 
Commit Message: 

### LOG
#build #dev`},{id:"NightlyDelta",icon:"üåô",label:"Nightly System Delta",content:`## üåô NIGHTLY DELTA ‚Äî {{DATE}}

### HUD
- Mood: /10
- Energy EOD: /10

### BODY
Shipped Today:
- 

Blockers Hit:
- 

Tomorrow's Focus:
- 

### CLOSE BLOCK
Gratitude: 
Learning: 

### LOG
#nightly #reflection`},{id:"WeeklyReview",icon:"üóìÔ∏è",label:"Weekly Review",content:`## üóìÔ∏è WEEKLY REVIEW ‚Äî {{DATE}}

### HUD
- Week Score: /10
- Big Wins: 

### BODY
Shipped this Week:
{{WEEKLY_LOGS}}

### REFLECTION
- What went well?
- What broke?
- Theme for Next Week: 

### LOG
#weekly #review`}];function nt(){return tt}function ot(e,t={}){const n=tt.find(a=>a.id===e||a.id.toLowerCase()===(e==null?void 0:e.toLowerCase()));if(!n)return"";let i=n.content;const o=new Date;return i=i.replace(/\{\{DATE\}\}/g,o.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})),i=i.replace(/\{\{TIME\}\}/g,o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),t.previousFocus?i=i.replace("{{PREVIOUS_FOCUS}}",t.previousFocus):i=i.replace("{{PREVIOUS_FOCUS}}",`1. 
2. 
3. `),t.shippedContext&&(i=i.replace(/- \n/,t.shippedContext+`
`)),t.weeklyLogs?i=i.replace("{{WEEKLY_LOGS}}",t.weeklyLogs):i=i.replace("{{WEEKLY_LOGS}}","-"),i}const an=[{keywords:["bug","fix","error","fail","broken","crash"],tag:"bug",category:"Bug"},{keywords:["idea","feature","maybe","wish","cool"],tag:"idea",category:"Idea"},{keywords:["meeting","call","sync","discuss","chat","meet"],tag:"meeting",category:"Meeting"},{keywords:["urgent","asap","critical","important","now","high priority"],tag:"urgent",category:"Urgent"},{keywords:["buy","order","purchase","shop","get"],tag:"shopping",category:"Shopping"}],rn=[{id:"urgent",title:"üî• Urgent",tags:["urgent","priority-high"]},{id:"bug",title:"üêõ Bugs",tags:["bug","fix"]},{id:"meeting",title:"üìÖ Meetings",tags:["meeting"]},{id:"idea",title:"üí° Ideas",tags:["idea"]},{id:"shopping",title:"üõí Shopping",tags:["shopping"]},{id:"other",title:"üìù Tasks",tags:[]}];function sn(e){const t=e.toLowerCase(),n=[];let i=null;return an.forEach(o=>{o.keywords.some(a=>t.includes(a))&&(n.push(o.tag),i||(i=o.category))}),{tags:n,category:i}}function cn(e){const t=rn.map(n=>({...n,items:[]}));return e.forEach(n=>{const i=(n.tags||[]).map(a=>a.toLowerCase().replace("#",""));let o=!1;for(const a of t)if(a.id!=="other"&&a.tags.some(r=>i.includes(r))){a.items.push(n),o=!0;break}if(!o){const a=t.find(r=>r.id==="other");a&&a.items.push(n)}}),t}let I,we,x,Ce,Be,W,U,it,at,Ee,u,Pe,We,rt,Ue,Q,st;document.querySelector('[data-action="close-menu"]');let k=null;const Fe=document.getElementById("templateBtn"),ct=document.getElementById("templateOverlay"),Ve=document.getElementById("templateList"),je=document.querySelector('[data-action="close-template"]');let y=null,T=null,L=null,ee=null,Z="",R="list",B=null,F=null;const lt=500,ln={inbox:{icon:"üì•",title:"Inbox",className:"section-inbox"},next:{icon:"üìã",title:"Next",className:"section-next"},shipToday:{icon:"üöÄ",title:"Ship Today",className:"section-ship"}};function dn(){I=document.getElementById("commander"),we=document.getElementById("captureView"),x=document.getElementById("saveStatus"),Ce=document.getElementById("contextMenu"),Be=document.getElementById("logContextMenu"),W=document.getElementById("menuOverlay"),U=document.getElementById("confirmOverlay"),it=document.getElementById("confirmTitle"),at=document.getElementById("confirmMessage"),Ee=document.getElementById("importInput"),u=document.getElementById("captureTextarea"),Pe=document.getElementById("pasteBtn"),We=document.getElementById("saveLogBtn"),rt=document.getElementById("routeSelect"),Ue=document.getElementById("logsSearch"),Q=document.getElementById("logsList"),st=document.getElementById("logsCount"),Wt(H),k=document.getElementById("quartermasterBtn"),Nn(),document.querySelectorAll("[data-action]").forEach(r=>{r.addEventListener("click",Cn)}),document.querySelectorAll("[data-move]").forEach(r=>{r.addEventListener("click",In)}),document.querySelectorAll("[data-log-action]").forEach(r=>{r.addEventListener("click",Tn)}),Ee.addEventListener("change",Dn),Pe.addEventListener("click",bn),We.addEventListener("click",xn),Fe&&Fe.addEventListener("click",vn),je&&je.addEventListener("click",_);const e=document.getElementById("timeBandit");e&&e.addEventListener("click",Vn);const t=document.getElementById("micBtn");t&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)&&(t.hidden=!1,t.addEventListener("click",En)),Ue.addEventListener("input",Sn);const n=document.getElementById("viewToggle");n&&n.addEventListener("click",dt);const i=document.getElementById("restoreInput");i&&i.addEventListener("change",Mn);const o=document.getElementById("shipOverlay");o&&o.addEventListener("click",r=>{r.target===o&&re()});const a=document.getElementById("templateOverlay");a&&a.addEventListener("click",r=>{r.target===a&&_()}),W.addEventListener("click",r=>{r.target===W&&g()}),U.addEventListener("click",r=>{r.target===U&&M()}),window.addEventListener("online",de),window.addEventListener("offline",de),window.addEventListener("commander-command",un),de(),document.addEventListener("keydown",Gn),H(v(),ae(),Y()),bt()}function un(e){const{command:t,text:n,tags:i,priority:o,silent:a,view:r}=e.detail;switch(console.log("[UI] Received command:",t,e.detail),t){case"add-task":case"add":if(n){let s=[...i],c="inbox";o&&s.push(o==="high"?"#priority":`#${o}`);const d=O(c,n);if(s.length>0){const f=`${n} ${s.join(" ")}`;ve(c,d,f)}a||(m(`Added: ${n}`,"success"),navigator.vibrate&&navigator.vibrate(50))}break;case"log":n&&(Ie(n,"automation"),a||m("Log added","info"));break;case"toggle-theme":document.body.classList.toggle("theme-light"),a||m("Theme toggled","info");break;case"focus-mode":a||m("Focus Mode activated","info"),b("tasks");break;case"navigate":r&&b(r);break}}async function de(){const e=document.getElementById("offlineIndicator");if(!e)return;!navigator.onLine?(e.textContent="üì° Offline",e.className="offline-indicator offline",e.hidden=!1):await Kt()?(e.textContent="üü¢ Ready",e.className="offline-indicator",e.hidden=!1):e.hidden=!0}function H(e,t,n){fn(t),mn(n),An(),document.startViewTransition?document.startViewTransition(()=>{He(n,e)}):He(n,e)}function He(e,t){e==="capture"?(I.hidden=!0,we.hidden=!1,ut(t)):(I.hidden=!1,we.hidden=!0,gn(t))}function mn(e){document.querySelectorAll(".action-btn-tab").forEach(t=>{const n=t.dataset.action;n==="view-tasks"?t.classList.toggle("active",e==="tasks"):n==="view-capture"&&t.classList.toggle("active",e==="capture")})}function gn(e){var o,a;if(R==="board"){pn(e);return}const t=document.activeElement,n=t&&t.classList.contains("item-content"),i=n?(a=(o=t.closest(".item"))==null?void 0:o.dataset)==null?void 0:a.id:null;if(n&&i){["inbox","next","shipToday"].forEach(r=>{const s=document.querySelector(`[data-section="${r}"] .section-count`);s&&(s.textContent=e[r].length)});return}if(I.innerHTML="",B){const r=document.createElement("div");r.className="filter-bar",r.innerHTML=`
            <span>Filtering: <strong>#${B}</strong></span>
            <button class="filter-clear-btn">‚úï Clear</button>
        `,r.querySelector(".filter-clear-btn").addEventListener("click",zn),I.appendChild(r)}["inbox","next","shipToday"].forEach(r=>{let s=e[r];B&&(s=s.filter(d=>d.tags&&d.tags.some(f=>f.replace("#","").toLowerCase()===B)));const c=hn(r,s);I.appendChild(c)})}function pn(e){I.innerHTML="";const t=[...e.inbox.map(o=>({...o,_section:"inbox"})),...e.next.map(o=>({...o,_section:"next"})),...e.shipToday.map(o=>({...o,_section:"shipToday"}))],n=cn(t),i=document.createElement("div");i.className="board-container",n.forEach(o=>{const a=document.createElement("div");a.className="board-column",a.classList.add(`board-col-${o.id}`),a.innerHTML=`
            <div class="board-header">
                <span class="board-title">${o.title}</span>
                <span class="board-count">${o.items.length}</span>
            </div>
        `;const r=document.createElement("ul");r.className="board-items",o.items.forEach(s=>{const c=mt(s._section,s);c.classList.add("board-card"),r.appendChild(c)}),a.appendChild(r),i.appendChild(a)}),I.appendChild(i)}function dt(){R=R==="list"?"board":"list";const e=document.getElementById("viewToggle");e&&(e.textContent=R==="list"?"üìã":"üìä",e.setAttribute("title",R==="list"?"Switch to Smart Board":"Switch to List")),H(v(),ae(),"tasks")}function ut(e){const t=Z?qt(Z):e.logs||[];if(st.textContent=t.length,Q.innerHTML="",t.length===0){const n=document.createElement("li");n.className="logs-empty",n.textContent=Z?"No logs match your search":"No logs yet. Capture something!",Q.appendChild(n)}else t.forEach(n=>{const i=yn(n);Q.appendChild(i)})}function fn(e){switch(x.className="status-indicator",e){case"saving":x.textContent="Saving‚Ä¶",x.classList.add("saving");break;case"saved":x.textContent="Saved ‚úì",x.classList.add("saved");break;case"error":x.textContent="Error!",x.classList.add("error");break;default:x.textContent="Ready"}}function hn(e,t){const n=ln[e],i=document.createElement("section");i.className=`section ${n.className}`,i.dataset.section=e;const o=document.createElement("header");o.className="section-header",o.innerHTML=`
    <span class="section-icon">${n.icon}</span>
    <h2 class="section-title">${n.title}</h2>
    <span class="section-count">${t.length}</span>
  `,i.appendChild(o);const a=document.createElement("ul");if(a.className="section-list",t.length===0){const r=document.createElement("li");r.className="section-empty";const c={inbox:{icon:"üì•",text:"Inbox empty ‚Äî capture something!"},next:{icon:"üéØ",text:"Nothing queued up"},shipToday:{icon:"üöÄ",text:"Ready to ship?"}}[e]||{icon:"üì≠",text:"No items"};r.innerHTML=`<span class="empty-icon">${c.icon}</span><span class="empty-text">${c.text}</span>`,a.appendChild(r)}else t.forEach(r=>{const s=mt(e,r);a.appendChild(s)});return i.appendChild(a),i}function mt(e,t){const n=document.createElement("li");n.className="item",n.dataset.id=t.id,n.dataset.section=e;const i=document.createElement("span");i.className="item-bullet",n.appendChild(i);const o=document.createElement("div");if(o.className="item-content",o.contentEditable="true",o.spellcheck=!0,o.textContent=t.text,o.addEventListener("input",()=>{ve(e,t.id,o.textContent)}),o.addEventListener("blur",()=>{const s=o.textContent.trim();s!==t.text&&ve(e,t.id,s)}),o.addEventListener("keydown",s=>{if(s.key==="Enter"&&!s.shiftKey){s.preventDefault();const c=O(e,"");requestAnimationFrame(()=>{const d=document.querySelector(`[data-id="${c}"] .item-content`);d&&d.focus()})}s.key==="Backspace"&&o.textContent===""&&(s.preventDefault(),Xe(e,t.id))}),n.appendChild(o),t.tags&&t.tags.length>0){const s=document.createElement("div");s.className="item-tags",t.tags.forEach(c=>{const d=document.createElement("span");d.className="item-tag",d.textContent=c.startsWith("#")?c:`#${c}`,d.addEventListener("click",f=>{f.stopPropagation(),qn(c)}),s.appendChild(d)}),n.appendChild(s)}const a=()=>{n.classList.add("long-pressing"),L=setTimeout(()=>{n.classList.remove("long-pressing"),kn(e,t.id)},lt)},r=()=>{n.classList.remove("long-pressing"),L&&(clearTimeout(L),L=null)};return n.addEventListener("touchstart",a,{passive:!0}),n.addEventListener("touchend",r),n.addEventListener("touchcancel",r),n.addEventListener("touchmove",r),n.addEventListener("mousedown",s=>{s.button===0&&a()}),n.addEventListener("mouseup",r),n.addEventListener("mouseleave",r),n}function yn(e){const t=document.createElement("li");t.className="log-item",t.dataset.logId=e.id;const n=new Date(e.createdAt).toLocaleString(),i=e.content.length>50?e.content.substring(0,50).replace(/\n/g," ")+"...":e.content.replace(/\n/g," ");t.innerHTML=`
    <div class="log-item-header">
      <div class="log-item-meta">
        <span class="log-item-date">${n}</span>
        <span class="log-item-preview">${_e(i)}</span>
      </div>
      <span class="log-item-source ${e.source==="clipboard"?"clipboard":""}">${e.source}</span>
    </div>
    <div class="log-item-content">
      <div class="log-item-full-text">${_e(e.content)}</div>
    </div>
  `;const o=t.querySelector(".log-item-header");o.addEventListener("click",()=>{t.classList.toggle("expanded")});const a=()=>{t.classList.add("long-pressing"),L=setTimeout(()=>{t.classList.remove("long-pressing"),Ln(e)},lt)},r=()=>{t.classList.remove("long-pressing"),L&&(clearTimeout(L),L=null)};return o.addEventListener("touchstart",a,{passive:!0}),o.addEventListener("touchend",r),o.addEventListener("touchcancel",r),o.addEventListener("touchmove",r),t}function _e(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function m(e,t="success"){const n=document.getElementById("toast");if(!n)return;const i={success:"‚úÖ",error:"‚ùå",info:"‚ÑπÔ∏è",warning:"‚ö†Ô∏è"},o=i[t]||i.success;n.textContent=`${o} ${e}`,n.className="toast show toast-"+t,navigator.vibrate&&navigator.vibrate(t==="error"?[50,50,50]:50),setTimeout(()=>{n.classList.remove("show")},3e3)}async function bn(){try{const e=await navigator.clipboard.readText();if(!e)return;const t=e.split(`
`).map(o=>o.trim()).filter(o=>o),n=/^(\-|\*|\d+\.)\s+/,i=t.filter(o=>n.test(o));if(i.length>1&&confirm(`Detected ${i.length} list items. Split them into separate Inbox tasks?`)){i.forEach(a=>{const r=a.replace(n,"").trim();r&&O("inbox",r)}),m(`‚úÖ Added ${i.length} items to Inbox`),b("tasks"),navigator.vibrate&&navigator.vibrate(50);return}u.value=e,u.focus()}catch(e){console.error("Failed to read clipboard:",e),alert("Permission to read clipboard denied.")}}function vn(){wn(),ct.hidden=!1}function _(){ct.hidden=!0}function wn(){const e=nt();Ve.innerHTML="";const t=document.createElement("div");t.style.cssText="display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr);",e.forEach(n=>{const i=document.createElement("button");i.className="menu-btn",i.style.cssText="height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; text-align: center;",i.innerHTML=`
            <span style="font-size: 24px;">${n.icon}</span>
            <span>${n.label}</span>
        `,i.onclick=()=>gt(n.id),t.appendChild(i)}),Ve.appendChild(t)}async function gt(e){let t={};if(e==="MissionControl"){const a=(v().logs||[]).find(r=>r.tags&&r.tags.includes("#nightly")||r.saveAs&&r.saveAs.includes("NightlyDelta"));if(a){const r=a.content.match(/Tomorrow's Focus:([\s\S]*?)(?:###|$)/);if(r&&r[1]){const s=r[1].trim().split(`
`).map(c=>c.trim()).filter(c=>c.startsWith("-")).map(c=>c.replace(/^-\s*/,"").trim()).filter(c=>c).map((c,d)=>`${d+1}. ${c}`).join(`
`);s&&(t.previousFocus=s,m("üîó Ouroboros Linked: Focus recovered","info"))}}}const n=ot(e,t);n&&(u.value=n,_(),u.focus())}function En(){const e=document.getElementById("micBtn"),t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return;if(e.classList.contains("recording")){window.recognitionInstance&&window.recognitionInstance.stop();return}const n=new t;window.recognitionInstance=n,n.continuous=!1,n.interimResults=!0,n.lang="en-US",e.classList.add("recording");const i=u.getAttribute("placeholder");u.setAttribute("placeholder","Listening...");let o=u.value;o&&!o.endsWith(" ")&&(o+=" ");let a="";n.onresult=r=>{let s="",c="";for(let E=r.resultIndex;E<r.results.length;++E)r.results[E].isFinal?a+=r.results[E][0].transcript:s+=r.results[E][0].transcript,c+=r.results[E][0].transcript;const d=/^(?:protocol|template)\s+(\w+)(?:\s+(.*))?/i,f=a.trim().match(d);if(f){const E=f[1].toLowerCase(),z=f[2]||"",se=nt().find(h=>h.id===E||h.label.toLowerCase().includes(E));if(se){let h=se.content;z&&(h.includes("Context:")?h=h.replace("Context: ",`Context: ${z}`):h.includes("Goal:")?h=h.replace("Goal: ",`Goal: ${z}`):h+=`
${z}`),u.value=h,m(`ü§ñ Protocol Droid: Loaded ${se.label}`),u.scrollTop=u.scrollHeight,e.classList.remove("recording"),window.recognitionInstance.stop();return}}u.value=o+c,u.scrollTop=u.scrollHeight},n.onend=()=>{e.classList.remove("recording"),u.setAttribute("placeholder",i),window.recognitionInstance=null,navigator.vibrate&&navigator.vibrate(50)},n.onerror=r=>{console.error("Speech recognition error",r.error),e.classList.remove("recording"),u.setAttribute("placeholder",i)},n.start()}function xn(){const e=u.value.trim();if(!e){alert("Nothing to save!");return}const t=rt.value,n="manual",{tags:i}=sn(e);Ie(e,n,t,i),u.value="",navigator.vibrate&&navigator.vibrate(50)}function Sn(e){Z=e.target.value,ut(v())}function kn(e,t){y={section:e,id:t},document.querySelectorAll("[data-move]").forEach(n=>{n.hidden=n.dataset.move===e}),Ce.hidden=!1,navigator.vibrate&&navigator.vibrate(50)}function te(){Ce.hidden=!0,y=null}function Ln(e){T=e,Be.hidden=!1,navigator.vibrate&&navigator.vibrate(50)}function Ge(){Be.hidden=!0,T=null}function In(e){const t=e.currentTarget.dataset.move;y&&Ut(y.section,t,y.id),te()}function Tn(e){const t=e.currentTarget.dataset.logAction;if(!T){Ge();return}switch(t){case"copy":navigator.clipboard.writeText(T.content).then(()=>{navigator.vibrate&&navigator.vibrate(50)}).catch(()=>{alert("Failed to copy")});break;case"send-inbox":O("inbox",T.content);break;case"send-ship":O("shipToday",T.content);break;case"delete":_t(T.id);break}Ge()}function Cn(e){var n;switch(e.currentTarget.dataset.action){case"view-tasks":b("tasks");break;case"view-capture":b("capture");break;case"add-inbox":Y()!=="tasks"&&b("tasks"),ue("inbox");break;case"add-next":Y()!=="tasks"&&b("tasks"),ue("next");break;case"add-ship":Y()!=="tasks"&&b("tasks"),ue("shipToday");break;case"menu":Bn();break;case"close-menu":g();break;case"export-md":Zt(),g();break;case"export-json":Xt(),g();break;case"import-json":Ee.click();break;case"undo":jt()?(Vt(),g()):alert("Nothing to undo");break;case"clear-all":De("Clear All?","This will delete all items in all sections. This cannot be undone.",()=>{Ft(),M(),g()});break;case"delete":y&&(Xe(y.section,y.id),te());break;case"cancel":te();break;case"mark-shipped":y&&pt(y.section,y.id);break;case"confirm-cancel":M();break;case"confirm-yes":ee&&ee();break;case"backup":nn(),g();break;case"restore":(n=document.getElementById("restoreInput"))==null||n.click();break;case"view-shipped":$n();break;case"close-ship":case"cancel-ship":re();break;case"confirm-ship":On();break;case"close-template":_();break;case"diagnostics":Rn();break;case"close-diag":ht();break;case"weekly-export":Pn();break;case"check-update":Wn();break;case"reset-cache":Un();break;case"export-debug":Fn();break;case"ai-setup":g(),window.location.href="./ai-setup.html";break;case"automations":g(),window.location.href="./automations.html";break;case"onboarding":g(),yt();break;case"close-onboarding":Jn();break}}function ue(e){const t=O(e,"");requestAnimationFrame(()=>{const n=document.querySelector(`[data-id="${t}"] .item-content`);n&&(n.focus(),n.scrollIntoView({behavior:"smooth",block:"center"}))})}function Bn(){W.hidden=!1}function g(){W.hidden=!0}function De(e,t,n){it.textContent=e,at.textContent=t,ee=n,U.hidden=!1}function M(){U.hidden=!0,ee=null}async function Dn(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(t){try{const i=await t.text(),o=en(i);De("Replace All Data?","This will replace all current items with the imported data. Continue?",async()=>{await Ht(o),M(),g()})}catch(i){alert(`Import failed: ${i.message}`)}e.target.value=""}}function An(){const e=document.getElementById("todayShipped");if(!e)return;const t=et();e.textContent=`${t.length} shipped`}function pt(e,t){F={section:e,id:t};const n=document.getElementById("shipOverlay");n&&(n.hidden=!1);const i=document.getElementById("shipSaveAs"),o=document.getElementById("shipDoD");i&&(i.value=""),o&&(o.value="")}function re(){const e=document.getElementById("shipOverlay");e&&(e.hidden=!0),F=null}function On(){var n,i,o,a;if(!F)return;const e=(i=(n=document.getElementById("shipSaveAs"))==null?void 0:n.value)==null?void 0:i.trim(),t=(a=(o=document.getElementById("shipDoD"))==null?void 0:o.value)==null?void 0:a.trim();if(!e){alert("Save As is required");return}if(!t){alert("Definition of Done is required");return}try{zt(F.section,F.id,e,t),re(),te(),navigator.vibrate&&navigator.vibrate(100)}catch(r){alert(r.message)}}async function Mn(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(t){try{const i=await t.text(),o=on(i,v());De("Merge Backup?",`Found ${o.stats.imported.inbox+o.stats.imported.next+o.stats.imported.shipToday} tasks and ${o.stats.imported.logs} logs to import. Duplicates will be skipped. Continue?`,async()=>{await Jt(o),M(),g(),alert(`Imported: ${o.stats.imported.inbox} inbox, ${o.stats.imported.next} next, ${o.stats.imported.shipToday} ship, ${o.stats.imported.logs} logs`)})}catch(i){alert(`Restore failed: ${i.message}`)}e.target.value=""}}function $n(){const e=et();if(e.length===0){alert("No items shipped today yet!");return}let t=`Today's Shipped (${e.length}):

`;e.forEach((n,i)=>{t+=`${i+1}. ${n.saveAs}
   DoD: ${n.definitionOfDone}

`}),alert(t),g()}window.openShipModal=pt;const ft="2026-01-05T14:31:51.719Z";function Nn(){if(!k)return;function e(){const t=new Date().getHours(),n=new Date().getDay();let i="",o="",a="";n===0&&t>=18?(i="Weekly Review",o="üóìÔ∏è",a="WeeklyReview"):t>=5&&t<10?(i="Plan Day",o="‚òÄÔ∏è",a="MissionControl"):t>=18||t<5?(i="Debrief",o="üåô",a="NightlyDelta"):(i="Quick Capture",o="‚ö°",a="capture"),k.querySelector(".label").textContent=i,k.querySelector(".icon").textContent=o,k.dataset.action=a,k.hidden=!1}e(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&e()}),k.addEventListener("click",()=>{const t=k.dataset.action;navigator.vibrate&&navigator.vibrate(50),t==="capture"?(b("capture"),u.focus()):gt(t)})}async function Rn(){var i;const e=document.getElementById("diagOverlay");if(!e)return;const t=await Ze();document.getElementById("diagVersion").textContent=ft.split("T")[0]||"dev",document.getElementById("diagSchema").textContent=`v${t.schemaVersion||"unknown"}`,document.getElementById("diagUpdated").textContent=((i=t.lastUpdated)==null?void 0:i.split("T")[0])||"never";const n=t.itemCounts||{};document.getElementById("diagCounts").textContent=`${n.inbox||0} inbox, ${n.next||0} next, ${n.logs||0} logs`,"serviceWorker"in navigator?navigator.serviceWorker.ready.then(o=>{document.getElementById("diagSW").textContent=o.active?"üü¢ Active":"üü° Waiting"}).catch(()=>{document.getElementById("diagSW").textContent="üî¥ Error"}):document.getElementById("diagSW").textContent="‚ö™ Not supported",e.hidden=!1,g()}function ht(){const e=document.getElementById("diagOverlay");e&&(e.hidden=!0)}function Pn(){const t=v().logs||[],n=new Date;n.setDate(n.getDate()-7);const i=t.filter(a=>new Date(a.createdAt)>=n);if(i.length===0){alert("No logs from the past 7 days.");return}let o=`# Commander Weekly Export
`;o+=`Exported: ${new Date().toISOString()}
`,o+=`Period: Last 7 days (${i.length} entries)

`,o+=`---

`,i.forEach(a=>{const r=new Date(a.createdAt).toLocaleString(),s=a.category||"Note";o+=`## [${s}] ${a.saveAs||"Untitled"} ‚Äî ${r}

`,o+=a.content+`

`,o+=`---

`}),navigator.clipboard.writeText(o).then(()=>{alert(`Copied ${i.length} logs to clipboard!

Paste into ChatGPT for analysis.`),g()}).catch(()=>{const a=new Blob([o],{type:"text/markdown"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=`commander-weekly-${new Date().toISOString().split("T")[0]}.md`,s.click(),URL.revokeObjectURL(r),g()})}async function Wn(){"serviceWorker"in navigator?(await(await navigator.serviceWorker.ready).update(),alert("Update check complete. If an update is available, it will install automatically.")):alert("Service workers not supported.")}async function Un(){if(confirm("This will clear cached files. Your data will NOT be lost. Continue?"))try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(t=>caches.delete(t)))}m("Cache cleared. Reloading...","info"),setTimeout(()=>location.reload(!0),500)}catch(e){alert("Failed to clear cache: "+e.message)}}async function Fn(){const e=await Ze(),t={exportedAt:new Date().toISOString(),appVersion:ft,schemaVersion:Se,diagnostics:e,userAgent:navigator.userAgent,online:navigator.onLine,serviceWorker:"serviceWorker"in navigator},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=`commander-debug-${new Date().toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(i),ht()}(function(){setTimeout(()=>{const t=document.querySelector("#menuOverlay .modal-body");if(t&&!document.getElementById("dailyDebriefBtn")){const n=document.querySelector('[data-action="weekly-export"]');if(n){const i=document.createElement("button");i.id="dailyDebriefBtn",i.className="menu-btn",i.innerHTML="üß† Copy Daily Debrief",i.onclick=_n,t.insertBefore(i,n)}}},1e3)})();let A=null,$=0,xe=0;function Vn(){if(A){confirm("Cancel current session?")&&(clearInterval(A),A=null,ne(null));return}const e=prompt("Set Focus Timer (minutes):","25");if(!e)return;const t=parseInt(e);isNaN(t)||t<=0||jn(t)}function jn(e){xe=e,$=e*60,ne($),navigator.vibrate&&navigator.vibrate([50,50,50]),m(`‚è≥ Focus: ${e}m started`),A=setInterval(()=>{$--,ne($),$<=0&&Hn()},1e3)}function Hn(){clearInterval(A),A=null,ne(null),Ie(`‚úÖ Focus Session: ${xe}m completed`,"auto","logs",["#focus"]),navigator.vibrate&&navigator.vibrate([200,100,200,100,500]),alert(`Time's Up! ${xe}m Session Logged.`)}function ne(e){const t=document.getElementById("timeBandit");if(!t)return;if(e===null){t.textContent="‚è≥",t.classList.remove("active");return}const n=Math.floor(e/60),i=e%60;t.textContent=`${n}:${i.toString().padStart(2,"0")}`,t.classList.add("active")}async function _n(){const e=Gt(),t=new Date().toISOString().split("T")[0],n=e.filter(a=>a.createdAt.startsWith(t));if(n.length===0){m("No logs for today.");return}const i=n.map(a=>`- [${new Date(a.createdAt).toLocaleTimeString()}] ${a.content}`).join(`
`),o=`DATE: ${t}
LOGS:
${i}

PROMPT:
Analyze my day based on these execution logs.
1. What was the highest leverage task?
2. Where was the friction or wasted time?
3. Grade my execution (A-F) with a short explanation.
4. Suggest one improvement for tomorrow.`;try{await navigator.clipboard.writeText(o),m("üß† Debrief Prompt copied to clipboard!")}catch(a){console.error("Failed to copy",a),m("Failed to copy.")}}function Gn(e){const t=e.target.tagName.toLowerCase();if(t==="input"||t==="textarea"||e.target.isContentEditable){e.key==="Escape"&&e.target.blur();return}if(e.key==="Escape"){g(),M(),closeContextMenu(),re(),_();return}if(e.key==="n"||e.key==="N"){e.preventDefault(),b("capture"),setTimeout(()=>u==null?void 0:u.focus(),100),m("New capture","info");return}if(e.key==="1"){me("inbox"),m("üì• Inbox","info");return}if(e.key==="2"){me("next"),m("üìã Next","info");return}if(e.key==="3"){me("shipToday"),m("üöÄ Ship Today","info");return}if(e.key==="?"||e.key==="h"){m("Shortcuts: n=new, 1/2/3=sections, Esc=close","info");return}if(e.key==="b"||e.key==="B"){dt();return}}function me(e){const t=document.querySelector(`[data-section="${e}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function qn(e){const t=e.replace("#","").toLowerCase();B=t,m(`Filtering: #${t}`,"info"),H(v(),ae(),"tasks")}function zn(){B=null,m("Filter cleared"),H(v(),ae(),"tasks")}function yt(){const e=document.getElementById("onboardingOverlay");e&&(e.hidden=!1)}function Jn(){const e=document.getElementById("onboardingOverlay");e&&(e.hidden=!0),localStorage.setItem("commander-onboarded","true")}function bt(){localStorage.getItem("commander-onboarded")||yt()}bt();function Kn(){const e=new URLSearchParams(window.location.search);if(e.get("safemode")==="1")return{safemode:!0};const t=e.get("screen"),n=e.get("view"),i=e.get("text"),o=e.get("template"),a=e.get("command"),r=e.get("tags"),s=e.get("priority"),c=e.get("silent")==="1"||e.get("silent")==="true",d=e.get("autofocus")==="1";return!t&&!n&&!i&&!o&&!a?null:{view:n||Yn(t)||(i?"capture":null),template:Qn(t)||o,text:i,command:a,tags:r?r.split(",").map(f=>f.trim()):[],priority:s,silent:c,autofocus:d,originalParams:e}}function Yn(e){return e?{"mission-control":"capture","micro-research":"capture","build-block":"capture","nightly-delta":"capture",capture:"capture",tasks:"tasks",inbox:"tasks"}[e]:null}function Qn(e){return e?{"mission-control":"MissionControl","micro-research":"MicroResearch","build-block":"BuildBlock","nightly-delta":"NightlyDelta"}[e]:null}function Zn(e,t){if(e){if(console.log("[Integrations] Applying launch params:",e),e.command||e.tags.length>0||e.priority||e.silent||e.text){const n=new CustomEvent("commander-command",{detail:e});window.dispatchEvent(n)}if(e.view&&t(e.view),e.view==="capture"&&setTimeout(()=>{const n=document.getElementById("captureTextarea");if(n){if(e.text&&!e.command)n.value=e.text;else if(e.template){const i=new CustomEvent("commander-fill-template",{detail:{template:e.template}});window.dispatchEvent(i)}(e.autofocus||e.text)&&!e.silent&&(n.focus(),n.value&&(n.selectionStart=n.selectionEnd=n.value.length))}},100),window.history.replaceState){const n=window.location.pathname+(e.safemode?"?safemode=1":"");window.history.replaceState({},document.title,n)}}}const vt="2026-01-05T14:31:51.719Z";async function qe(){console.log(`[Commander] Starting v${vt}...`);const e=Kn();if(e!=null&&e.safemode){Xn();return}try{await G(),console.log("[Commander] Database initialized"),await Re(),console.log("[Commander] State loaded"),dn(),console.log("[Commander] UI initialized"),Zn(e,b),window.addEventListener("commander-fill-template",t=>{const n=document.getElementById("captureTextarea");n&&t.detail.template&&(n.value=ot(t.detail.template,{}))}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(console.log("[Commander] App visible, refreshing state"),Re())}),console.log("[Commander] Ready!")}catch(t){console.error("[Commander] Bootstrap failed:",t),eo(t)}}function Xn(){document.body.innerHTML=`
    <div style="padding: 20px; font-family: sans-serif; background: #0a0a0f; color: #f0f0f5; min-height: 100vh;">
      <h1 style="color: #f59e0b;">üõ°Ô∏è Commander Safe Mode</h1>
      <p style="color: #a0a0b0; margin: 16px 0;">Running in minimal mode for recovery and debugging.</p>
      
      <div style="margin: 24px 0; display: flex; flex-direction: column; gap: 12px;">
        <button onclick="exportEmergencyBackup()" style="padding: 16px; background: #00d4ff; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          üì¶ Export Emergency Backup
        </button>
        <button onclick="location.href='./?'" style="padding: 16px; background: #1a1a24; color: #f0f0f5; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          üîÑ Try Normal Mode
        </button>
        <button onclick="clearAndReload()" style="padding: 16px; background: #ef4444; color: #fff; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          üóëÔ∏è Clear Cache & Reload
        </button>
      </div>
      
      <div style="background: #12121a; padding: 16px; border-radius: 8px; margin-top: 24px;">
        <h3 style="margin-bottom: 12px;">Diagnostics</h3>
        <p style="font-size: 14px; color: #606070;">Version: ${vt}</p>
        <p style="font-size: 14px; color: #606070;" id="swStatus">Service Worker: Checking...</p>
        <p style="font-size: 14px; color: #606070;" id="dbStatus">Database: Checking...</p>
      </div>
    </div>
  `,"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{document.getElementById("swStatus").textContent="Service Worker: "+(e.active?"üü¢ Active":"üü° Waiting")}).catch(()=>{document.getElementById("swStatus").textContent="Service Worker: üî¥ Error"});try{const e=indexedDB.open("commander-db");e.onsuccess=()=>{document.getElementById("dbStatus").textContent="Database: üü¢ Accessible"},e.onerror=()=>{document.getElementById("dbStatus").textContent="Database: üî¥ Error"}}catch{document.getElementById("dbStatus").textContent="Database: üî¥ Failed"}window.exportEmergencyBackup=async function(){try{const e=indexedDB.open("commander-db",3);e.onsuccess=()=>{const o=e.result.transaction("documents","readonly").objectStore("documents").get("main");o.onsuccess=()=>{const a=o.result||{},r=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),s=URL.createObjectURL(r),c=document.createElement("a");c.href=s,c.download=`commander-emergency-${new Date().toISOString().split("T")[0]}.json`,c.click(),URL.revokeObjectURL(s)}}}catch(e){alert("Export failed: "+e.message)}},window.clearAndReload=async function(){if(confirm("This will clear cached files (not your data). Continue?")){if("caches"in window){const e=await caches.keys();await Promise.all(e.map(t=>caches.delete(t)))}location.reload()}}}function eo(e){document.body.innerHTML=`
    <div style="padding: 20px; font-family: sans-serif; background: #0a0a0f; color: #f0f0f5; min-height: 100vh;">
      <h1 style="color: #ef4444;">‚ö†Ô∏è Commander Failed to Start</h1>
      <p style="color: #a0a0b0; margin: 16px 0;">${e.message}</p>
      
      <div style="margin: 24px 0; display: flex; flex-direction: column; gap: 12px;">
        <button onclick="location.reload()" style="padding: 16px; background: #00d4ff; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          üîÑ Try Again
        </button>
        <button onclick="location.href='./?safemode=1'" style="padding: 16px; background: #f59e0b; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
          üõ°Ô∏è Enter Safe Mode
        </button>
      </div>
      
      <details style="margin-top: 24px; background: #12121a; padding: 16px; border-radius: 8px;">
        <summary style="cursor: pointer; color: #606070;">Technical Details</summary>
        <pre style="font-size: 12px; color: #ef4444; margin-top: 12px; overflow-x: auto;">${e.stack||e}</pre>
      </details>
    </div>
  `}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",qe):qe();
